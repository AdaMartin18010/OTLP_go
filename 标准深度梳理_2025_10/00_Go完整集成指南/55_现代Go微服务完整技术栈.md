# 55. ç°ä»£ Go å¾®æœåŠ¡å®Œæ•´æŠ€æœ¯æ ˆ

## ğŸ“š ç›®å½•

- [55. ç°ä»£ Go å¾®æœåŠ¡å®Œæ•´æŠ€æœ¯æ ˆ](#55-ç°ä»£-go-å¾®æœåŠ¡å®Œæ•´æŠ€æœ¯æ ˆ)
  - [ğŸ“š ç›®å½•](#-ç›®å½•)
  - [1. æŠ€æœ¯æ ˆæ¦‚è¿°](#1-æŠ€æœ¯æ ˆæ¦‚è¿°)
    - [1.1 å®Œæ•´æŠ€æœ¯æ ˆ](#11-å®Œæ•´æŠ€æœ¯æ ˆ)
    - [1.2 ä¾èµ–ç‰ˆæœ¬](#12-ä¾èµ–ç‰ˆæœ¬)
  - [2. åˆ†å¸ƒå¼ç¼“å­˜ç­–ç•¥](#2-åˆ†å¸ƒå¼ç¼“å­˜ç­–ç•¥)
    - [2.1 Redis é›†ç¾¤é›†æˆ](#21-redis-é›†ç¾¤é›†æˆ)
    - [2.2 åˆ†å¸ƒå¼é”](#22-åˆ†å¸ƒå¼é”)
    - [2.3 ç¼“å­˜æ¨¡å¼](#23-ç¼“å­˜æ¨¡å¼)
  - [3. æœåŠ¡ç½‘æ ¼é›†æˆ](#3-æœåŠ¡ç½‘æ ¼é›†æˆ)
    - [3.1 Istio é›†æˆ](#31-istio-é›†æˆ)
    - [3.2 æœåŠ¡ç½‘æ ¼è¿½è¸ª](#32-æœåŠ¡ç½‘æ ¼è¿½è¸ª)
  - [4. å®Œæ•´æ¶æ„ç¤ºä¾‹](#4-å®Œæ•´æ¶æ„ç¤ºä¾‹)
    - [4.1 å¾®æœåŠ¡æ¶æ„å›¾](#41-å¾®æœåŠ¡æ¶æ„å›¾)
    - [4.2 å®Œæ•´æœåŠ¡å®ç°](#42-å®Œæ•´æœåŠ¡å®ç°)
  - [5. æ€»ç»“](#5-æ€»ç»“)
    - [æŠ€æœ¯æ ˆæ€»è§ˆ](#æŠ€æœ¯æ ˆæ€»è§ˆ)
    - [æ ¸å¿ƒä¼˜åŠ¿](#æ ¸å¿ƒä¼˜åŠ¿)
    - [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## 1. æŠ€æœ¯æ ˆæ¦‚è¿°

### 1.1 å®Œæ•´æŠ€æœ¯æ ˆ

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç°ä»£ Go å¾®æœåŠ¡æŠ€æœ¯æ ˆ              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŒ API å±‚                                â”‚
â”‚   â”œâ”€ Chi (HTTP)                          â”‚
â”‚   â”œâ”€ gRPC (RPC)                          â”‚
â”‚   â”œâ”€ GraphQL (çµæ´»æŸ¥è¯¢)                  â”‚
â”‚   â””â”€ WebSocket (å®æ—¶é€šä¿¡)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¨ æ¶ˆæ¯é˜Ÿåˆ—                               â”‚
â”‚   â”œâ”€ NATS (å®æ—¶æ¶ˆæ¯)                      â”‚
â”‚   â”œâ”€ Kafka (äº‹ä»¶æµ)                      â”‚
â”‚   â””â”€ RabbitMQ (ä»»åŠ¡é˜Ÿåˆ—)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¾ æ•°æ®å­˜å‚¨                               â”‚
â”‚   â”œâ”€ PostgreSQL (å…³ç³»å‹)                 â”‚
â”‚   â”œâ”€ MongoDB (æ–‡æ¡£å‹)                    â”‚
â”‚   â”œâ”€ Redis (ç¼“å­˜)                        â”‚
â”‚   â””â”€ Elasticsearch (æœç´¢)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” å¯è§‚æµ‹æ€§                               â”‚
â”‚   â”œâ”€ OpenTelemetry (è¿½è¸ª)               â”‚
â”‚   â”œâ”€ Prometheus (æŒ‡æ ‡)                   â”‚
â”‚   â”œâ”€ Jaeger (åˆ†å¸ƒå¼è¿½è¸ª)                 â”‚
â”‚   â””â”€ Grafana (å¯è§†åŒ–)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜ï¸  åŸºç¡€è®¾æ–½                              â”‚
â”‚   â”œâ”€ Docker (å®¹å™¨åŒ–)                     â”‚
â”‚   â”œâ”€ Kubernetes (ç¼–æ’)                   â”‚
â”‚   â”œâ”€ Istio (æœåŠ¡ç½‘æ ¼)                    â”‚
â”‚   â””â”€ Terraform (IaC)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ä¾èµ–ç‰ˆæœ¬

```go
// go.mod
module github.com/yourorg/microservice

go 1.25.1

require (
    // HTTP æ¡†æ¶
    github.com/go-chi/chi/v5 v5.1.0
    
    // gRPC
    google.golang.org/grpc v1.69.2
    google.golang.org/protobuf v1.36.0
    
    // GraphQL
    github.com/99designs/gqlgen v0.17.59
    
    // WebSocket
    github.com/gorilla/websocket v1.5.3
    
    // æ¶ˆæ¯é˜Ÿåˆ—
    github.com/nats-io/nats.go v1.37.0
    github.com/IBM/sarama v1.43.3
    
    // æ•°æ®åº“
    gorm.io/gorm v1.25.12
    gorm.io/driver/postgres v1.5.11
    go.mongodb.org/mongo-driver v1.17.1
    
    // Redis
    github.com/redis/go-redis/v9 v9.7.0
    
    // OTLP
    go.opentelemetry.io/otel v1.32.0
    go.opentelemetry.io/otel/trace v1.32.0
    go.opentelemetry.io/otel/metric v1.32.0
    go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgrpc v0.57.0
    go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp v0.57.0
    
    // å·¥å…·
    github.com/google/uuid v1.6.0
    github.com/spf13/viper v1.19.0
    go.uber.org/zap v1.27.0
)
```

---

## 2. åˆ†å¸ƒå¼ç¼“å­˜ç­–ç•¥

### 2.1 Redis é›†ç¾¤é›†æˆ

```go
// internal/cache/redis_cluster.go
package cache

import (
    "context"
    "encoding/json"
    "time"
    
    "github.com/redis/go-redis/v9"
    "go.opentelemetry.io/otel"
    "go.opentelemetry.io/otel/attribute"
    "go.opentelemetry.io/otel/trace"
)

// RedisCluster Redis é›†ç¾¤å®¢æˆ·ç«¯
type RedisCluster struct {
    client *redis.ClusterClient
    tracer trace.Tracer
}

// NewRedisCluster åˆ›å»º Redis é›†ç¾¤å®¢æˆ·ç«¯
func NewRedisCluster(addrs []string) *RedisCluster {
    client := redis.NewClusterClient(&redis.ClusterOptions{
        Addrs:        addrs,
        PoolSize:     100,
        MinIdleConns: 10,
        MaxRetries:   3,
    })
    
    return &RedisCluster{
        client: client,
        tracer: otel.Tracer("redis-cluster"),
    }
}

// Get è·å–ç¼“å­˜
func (c *RedisCluster) Get(ctx context.Context, key string) (string, error) {
    ctx, span := c.tracer.Start(ctx, "redis.get",
        trace.WithAttributes(
            attribute.String("cache.key", key),
        ),
    )
    defer span.End()
    
    val, err := c.client.Get(ctx, key).Result()
    if err != nil {
        if err == redis.Nil {
            span.SetAttributes(attribute.Bool("cache.hit", false))
            return "", nil
        }
        span.RecordError(err)
        return "", err
    }
    
    span.SetAttributes(attribute.Bool("cache.hit", true))
    return val, nil
}

// Set è®¾ç½®ç¼“å­˜
func (c *RedisCluster) Set(ctx context.Context, key string, value interface{}, expiration time.Duration) error {
    ctx, span := c.tracer.Start(ctx, "redis.set")
    defer span.End()
    
    data, err := json.Marshal(value)
    if err != nil {
        span.RecordError(err)
        return err
    }
    
    return c.client.Set(ctx, key, data, expiration).Err()
}

// Delete åˆ é™¤ç¼“å­˜
func (c *RedisCluster) Delete(ctx context.Context, keys ...string) error {
    ctx, span := c.tracer.Start(ctx, "redis.delete")
    defer span.End()
    
    return c.client.Del(ctx, keys...).Err()
}
```

### 2.2 åˆ†å¸ƒå¼é”

```go
// DistributedLock åˆ†å¸ƒå¼é”
type DistributedLock struct {
    client *redis.ClusterClient
    tracer trace.Tracer
}

// Lock è·å–é”
func (l *DistributedLock) Lock(ctx context.Context, key string, ttl time.Duration) (bool, error) {
    ctx, span := l.tracer.Start(ctx, "lock.acquire",
        trace.WithAttributes(
            attribute.String("lock.key", key),
        ),
    )
    defer span.End()
    
    ok, err := l.client.SetNX(ctx, key, "locked", ttl).Result()
    if err != nil {
        span.RecordError(err)
        return false, err
    }
    
    span.SetAttributes(attribute.Bool("lock.acquired", ok))
    return ok, nil
}

// Unlock é‡Šæ”¾é”
func (l *DistributedLock) Unlock(ctx context.Context, key string) error {
    ctx, span := l.tracer.Start(ctx, "lock.release")
    defer span.End()
    
    return l.client.Del(ctx, key).Err()
}

// WithLock ä½¿ç”¨é”æ‰§è¡Œå‡½æ•°
func (l *DistributedLock) WithLock(ctx context.Context, key string, ttl time.Duration, fn func(ctx context.Context) error) error {
    // å°è¯•è·å–é”
    acquired, err := l.Lock(ctx, key, ttl)
    if err != nil {
        return err
    }
    if !acquired {
        return fmt.Errorf("failed to acquire lock")
    }
    
    defer l.Unlock(ctx, key)
    
    // æ‰§è¡Œå‡½æ•°
    return fn(ctx)
}
```

### 2.3 ç¼“å­˜æ¨¡å¼

```go
// CacheAside Cache-Aside æ¨¡å¼
func (s *Service) GetUser(ctx context.Context, userID string) (*User, error) {
    ctx, span := s.tracer.Start(ctx, "service.get_user")
    defer span.End()
    
    cacheKey := fmt.Sprintf("user:%s", userID)
    
    // 1. å°è¯•ä»ç¼“å­˜è·å–
    cached, err := s.cache.Get(ctx, cacheKey)
    if err == nil && cached != "" {
        var user User
        if err := json.Unmarshal([]byte(cached), &user); err == nil {
            span.SetAttributes(attribute.Bool("cache.hit", true))
            return &user, nil
        }
    }
    
    span.SetAttributes(attribute.Bool("cache.hit", false))
    
    // 2. ä»æ•°æ®åº“è·å–
    user, err := s.db.GetUser(ctx, userID)
    if err != nil {
        return nil, err
    }
    
    // 3. å†™å…¥ç¼“å­˜
    s.cache.Set(ctx, cacheKey, user, 5*time.Minute)
    
    return user, nil
}

// WriteThrough Write-Through æ¨¡å¼
func (s *Service) UpdateUser(ctx context.Context, user *User) error {
    ctx, span := s.tracer.Start(ctx, "service.update_user")
    defer span.End()
    
    // 1. å†™å…¥æ•°æ®åº“
    if err := s.db.UpdateUser(ctx, user); err != nil {
        return err
    }
    
    // 2. æ›´æ–°ç¼“å­˜
    cacheKey := fmt.Sprintf("user:%s", user.ID)
    if err := s.cache.Set(ctx, cacheKey, user, 5*time.Minute); err != nil {
        // ç¼“å­˜æ›´æ–°å¤±è´¥ï¼Œè®°å½•é”™è¯¯ä½†ä¸è¿”å›
        span.RecordError(err)
    }
    
    return nil
}
```

---

## 3. æœåŠ¡ç½‘æ ¼é›†æˆ

### 3.1 Istio é›†æˆ

```yaml
# k8s/service-mesh.yaml
apiVersion: v1
kind: Service
metadata:
  name: user-service
  labels:
    app: user-service
spec:
  ports:
  - port: 8080
    name: http
  - port: 9090
    name: grpc
  selector:
    app: user-service
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: user-service
      version: v1
  template:
    metadata:
      labels:
        app: user-service
        version: v1
      annotations:
        sidecar.istio.io/inject: "true"
    spec:
      containers:
      - name: user-service
        image: user-service:latest
        ports:
        - containerPort: 8080
        - containerPort: 9090
        env:
        - name: OTEL_EXPORTER_OTLP_ENDPOINT
          value: "otel-collector:4317"
---
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: user-service
spec:
  hosts:
  - user-service
  http:
  - match:
    - headers:
        x-canary:
          exact: "true"
    route:
    - destination:
        host: user-service
        subset: v2
      weight: 100
  - route:
    - destination:
        host: user-service
        subset: v1
      weight: 100
---
apiVersion: networking.istio.io/v1beta1
kind:DestinationRule
metadata:
  name: user-service
spec:
  host: user-service
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2
  trafficPolicy:
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        http1MaxPendingRequests: 50
        http2MaxRequests: 100
    outlierDetection:
      consecutiveErrors: 5
      interval: 30s
      baseEjectionTime: 30s
```

### 3.2 æœåŠ¡ç½‘æ ¼è¿½è¸ª

```go
// è‡ªåŠ¨è¿½è¸ªï¼ˆé€šè¿‡ Istio Sidecarï¼‰
// æ— éœ€ä¿®æ”¹ä»£ç ï¼ŒIstio è‡ªåŠ¨æ³¨å…¥è¿½è¸ª Header

// æ‰‹åŠ¨ä¼ æ’­è¿½è¸ªä¸Šä¸‹æ–‡
func (c *ServiceClient) CallService(ctx context.Context, req *Request) (*Response, error) {
    // åˆ›å»º HTTP è¯·æ±‚
    httpReq, _ := http.NewRequestWithContext(ctx, "POST", "http://other-service/api", nil)
    
    // Istio ä¼šè‡ªåŠ¨ä» HTTP Header æå–è¿½è¸ªä¿¡æ¯
    // æ ‡å‡† Header: traceparent, tracestate
    
    resp, err := http.DefaultClient.Do(httpReq)
    if err != nil {
        return nil, err
    }
    defer resp.Body.Close()
    
    var response Response
    json.NewDecoder(resp.Body).Decode(&response)
    return &response, nil
}
```

---

## 4. å®Œæ•´æ¶æ„ç¤ºä¾‹

### 4.1 å¾®æœåŠ¡æ¶æ„å›¾

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  API Gateway (Kong/APISIX)            â”‚
â”‚                  â†“                                    â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚           â”‚   Istio     â”‚  (Service Mesh)            â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                  â†“                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  User    â”‚  â”‚  Order   â”‚  â”‚  Payment â”‚           â”‚
â”‚  â”‚ Service  â”‚â†’ â”‚ Service  â”‚â†’ â”‚ Service  â”‚           â”‚
â”‚  â”‚ (gRPC)   â”‚  â”‚ (HTTP)   â”‚  â”‚ (gRPC)   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚
â”‚       â”‚             â”‚             â”‚                  â”‚
â”‚       â†“             â†“             â†“                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚         NATS / Kafka (äº‹ä»¶æ€»çº¿)      â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚       â”‚             â”‚             â”‚                  â”‚
â”‚       â†“             â†“             â†“                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚PostgreSQLâ”‚  â”‚ MongoDB â”‚  â”‚  Redis  â”‚             â”‚
â”‚  â”‚ (ä¸»æ•°æ®) â”‚  â”‚ (æ–‡æ¡£)   â”‚  â”‚ (ç¼“å­˜)  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 å¯è§‚æµ‹æ€§å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚OpenTelemetryâ”‚â†’â”‚ Jaeger   â”‚â†’â”‚  Grafana   â”‚      â”‚
â”‚  â”‚ Collector  â”‚  â”‚(Tracing) â”‚  â”‚(Dashboard) â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                      â†‘                               â”‚
â”‚                 Prometheus                           â”‚
â”‚                  (Metrics)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å®Œæ•´æœåŠ¡å®ç°

```go
// cmd/main.go
package main

import (
    "context"
    "log"
    "net/http"
    "os"
    "os/signal"
    "syscall"
    
    "github.com/go-chi/chi/v5"
    "github.com/yourorg/microservice/internal/api"
    "github.com/yourorg/microservice/internal/cache"
    "github.com/yourorg/microservice/internal/config"
    "github.com/yourorg/microservice/internal/database"
    "github.com/yourorg/microservice/internal/messaging"
    "github.com/yourorg/microservice/internal/observability"
)

func main() {
    // åŠ è½½é…ç½®
    cfg := config.Load()
    
    // åˆå§‹åŒ–å¯è§‚æµ‹æ€§
    tp, mp, err := observability.Init(cfg.ServiceName, cfg.OTLPEndpoint)
    if err != nil {
        log.Fatal(err)
    }
    defer tp.Shutdown(context.Background())
    defer mp.Shutdown(context.Background())
    
    // åˆå§‹åŒ–æ•°æ®åº“
    db, err := database.NewPostgres(cfg.DatabaseURL)
    if err != nil {
        log.Fatal(err)
    }
    defer db.Close()
    
    // åˆå§‹åŒ–ç¼“å­˜
    cache := cache.NewRedisCluster(cfg.RedisAddrs)
    
    // åˆå§‹åŒ–æ¶ˆæ¯é˜Ÿåˆ—
    nats, err := messaging.NewNATSClient(cfg.NATSUrl)
    if err != nil {
        log.Fatal(err)
    }
    defer nats.Close()
    
    // åˆå§‹åŒ–æœåŠ¡
    userService := api.NewUserService(db, cache, nats)
    
    // åˆ›å»ºè·¯ç”±
    r := chi.NewRouter()
    
    // æ³¨å†Œè·¯ç”±
    api.RegisterHTTPRoutes(r, userService)
    
    // å¯åŠ¨ HTTP æœåŠ¡å™¨
    srv := &http.Server{
        Addr:    ":" + cfg.Port,
        Handler: r,
    }
    
    // ä¼˜é›…å…³é—­
    go func() {
        sigint := make(chan os.Signal, 1)
        signal.Notify(sigint, os.Interrupt, syscall.SIGTERM)
        <-sigint
        
        log.Println("Shutting down...")
        srv.Shutdown(context.Background())
    }()
    
    log.Printf("Server starting on :%s", cfg.Port)
    if err := srv.ListenAndServe(); err != nil && err != http.ErrServerClosed {
        log.Fatal(err)
    }
}
```

---

## 5. æ€»ç»“

### æŠ€æœ¯æ ˆæ€»è§ˆ

| åˆ†ç±» | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ |
|------|---------|------|
| **HTTP æ¡†æ¶** | Chi | v5.1.0 |
| **RPC æ¡†æ¶** | gRPC | v1.69.2 |
| **GraphQL** | gqlgen | v0.17.59 |
| **WebSocket** | gorilla/websocket | v1.5.3 |
| **æ¶ˆæ¯é˜Ÿåˆ—** | NATS | v1.37.0 |
| **äº‹ä»¶æµ** | Kafka | Sarama v1.43.3 |
| **æ•°æ®åº“** | PostgreSQL + GORM | v1.25.12 |
| **NoSQL** | MongoDB | v1.17.1 |
| **ç¼“å­˜** | Redis Cluster | v9.7.0 |
| **è¿½è¸ª** | OpenTelemetry | v1.32.0 |
| **æœåŠ¡ç½‘æ ¼** | Istio | Latest |

### æ ¸å¿ƒä¼˜åŠ¿

âœ… **å®Œæ•´æŠ€æœ¯æ ˆ** - è¦†ç›–æ‰€æœ‰ç°ä»£å¾®æœåŠ¡éœ€æ±‚  
âœ… **é«˜æ€§èƒ½** - ç»è¿‡éªŒè¯çš„é«˜æ€§èƒ½ç»„ä»¶  
âœ… **å¯è§‚æµ‹æ€§** - å®Œæ•´çš„ OTLP é›†æˆ  
âœ… **å¯æ‰©å±•** - æ”¯æŒæ°´å¹³æ‰©å±•  
âœ… **ç”Ÿäº§å°±ç»ª** - ä¼ä¸šçº§ç¨³å®šæ€§

### æœ€ä½³å®è·µ

1. âœ… ä½¿ç”¨ Service Mesh ç®¡ç†æœåŠ¡é—´é€šä¿¡
2. âœ… å®ç°åˆ†å¸ƒå¼ç¼“å­˜å’Œåˆ†å¸ƒå¼é”
3. âœ… é›†æˆå®Œæ•´çš„ OTLP è¿½è¸ª
4. âœ… ä½¿ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„è§£è€¦æœåŠ¡
5. âœ… å®ç°å¤šçº§ç¼“å­˜ç­–ç•¥
6. âœ… å®¹å™¨åŒ–å’Œ Kubernetes éƒ¨ç½²
7. âœ… å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦
8. âœ… CI/CD è‡ªåŠ¨åŒ–

### ç›¸å…³æ–‡æ¡£

- [49_Chiæ¡†æ¶æ·±åº¦é›†æˆ](./49_Chiæ¡†æ¶æ·±åº¦é›†æˆä¸æœ€ä½³å®è·µ.md)
- [50_ç°ä»£Goæ¶æ„æ¨¡å¼](./50_ç°ä»£Goæ¶æ„æ¨¡å¼_Clean_Architecture.md)
- [51_gRPCå®Œæ•´é›†æˆ](./51_gRPCå®Œæ•´é›†æˆæŒ‡å—ä¸æœ€ä½³å®è·µ.md)
- [52_äº‹ä»¶é©±åŠ¨æ¶æ„](./52_äº‹ä»¶é©±åŠ¨æ¶æ„_NATSä¸Kafkaé›†æˆ.md)
- [53_GraphQLå®Œæ•´é›†æˆ](./53_GraphQLå®Œæ•´é›†æˆ_gqlgenæœ€ä½³å®è·µ.md)
- [54_WebSocketå®æ—¶é€šä¿¡](./54_WebSocketå®æ—¶é€šä¿¡å®Œæ•´æŒ‡å—.md)

---

**ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025-10-11  
**Go ç‰ˆæœ¬**: 1.25.1

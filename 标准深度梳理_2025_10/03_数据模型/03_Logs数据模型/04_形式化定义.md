# Logs å½¢å¼åŒ–å®šä¹‰

## ğŸ“‹ ç›®å½•

- [Logs å½¢å¼åŒ–å®šä¹‰](#logs-å½¢å¼åŒ–å®šä¹‰)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [æ¦‚è¿°](#æ¦‚è¿°)
  - [åŸºæœ¬å®šä¹‰](#åŸºæœ¬å®šä¹‰)
    - [1. LogRecord å®šä¹‰](#1-logrecord-å®šä¹‰)
    - [2. æ—¶é—´æˆ³å®šä¹‰](#2-æ—¶é—´æˆ³å®šä¹‰)
    - [3. SeverityNumber å®šä¹‰](#3-severitynumber-å®šä¹‰)
    - [4. AnyValue å®šä¹‰](#4-anyvalue-å®šä¹‰)
  - [LogRecord çš„å½¢å¼åŒ–](#logrecord-çš„å½¢å¼åŒ–)
    - [1. å®Œæ•´å®šä¹‰](#1-å®Œæ•´å®šä¹‰)
    - [2. æœ‰æ•ˆæ€§æ¡ä»¶](#2-æœ‰æ•ˆæ€§æ¡ä»¶)
  - [SeverityNumber çš„å½¢å¼åŒ–](#severitynumber-çš„å½¢å¼åŒ–)
    - [1. å…¨åºå…³ç³»](#1-å…¨åºå…³ç³»)
    - [2. çº§åˆ«æ˜ å°„](#2-çº§åˆ«æ˜ å°„)
  - [Body å’Œ Attributes çš„å½¢å¼åŒ–](#body-å’Œ-attributes-çš„å½¢å¼åŒ–)
    - [1. Body å®šä¹‰](#1-body-å®šä¹‰)
    - [2. Attributes å®šä¹‰](#2-attributes-å®šä¹‰)
    - [3. å±æ€§æ“ä½œ](#3-å±æ€§æ“ä½œ)
  - [ä¸å˜é‡](#ä¸å˜é‡)
    - [1. æ—¶é—´ä¸å˜é‡](#1-æ—¶é—´ä¸å˜é‡)
    - [2. ä¸¥é‡æ€§ä¸å˜é‡](#2-ä¸¥é‡æ€§ä¸å˜é‡)
    - [3. å±æ€§ä¸å˜é‡](#3-å±æ€§ä¸å˜é‡)
  - [æ­£ç¡®æ€§è¯æ˜](#æ­£ç¡®æ€§è¯æ˜)
    - [1. æ—¶é—´æˆ³ä¸€è‡´æ€§](#1-æ—¶é—´æˆ³ä¸€è‡´æ€§)
    - [2. ä¸¥é‡æ€§æœ‰åºæ€§](#2-ä¸¥é‡æ€§æœ‰åºæ€§)
    - [3. å±æ€§åˆå¹¶æ­£ç¡®æ€§](#3-å±æ€§åˆå¹¶æ­£ç¡®æ€§)
  - [æ€§èƒ½åˆ†æ](#æ€§èƒ½åˆ†æ)
    - [1. æ—¶é—´å¤æ‚åº¦](#1-æ—¶é—´å¤æ‚åº¦)
    - [2. ç©ºé—´å¤æ‚åº¦](#2-ç©ºé—´å¤æ‚åº¦)
  - [TLA+ è§„èŒƒ](#tla-è§„èŒƒ)
  - [Go å®ç°éªŒè¯](#go-å®ç°éªŒè¯)
    - [1. ç±»å‹å®‰å…¨](#1-ç±»å‹å®‰å…¨)
    - [2. å¹¶å‘å®‰å…¨](#2-å¹¶å‘å®‰å…¨)
  - [å‚è€ƒèµ„æº](#å‚è€ƒèµ„æº)

---

## æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾› OpenTelemetry Logs æ•°æ®æ¨¡å‹çš„å½¢å¼åŒ–å®šä¹‰ï¼ŒåŒ…æ‹¬æ•°å­¦æ¨¡å‹ã€æ­£ç¡®æ€§è¯æ˜å’Œæ€§èƒ½åˆ†æã€‚

---

## åŸºæœ¬å®šä¹‰

### 1. LogRecord å®šä¹‰

**å®šä¹‰ 1.1 (LogRecord)**:

LogRecord æ˜¯ä¸€ä¸ªå…ƒç»„ï¼š

\[
LR = (T, T_{obs}, S_n, S_t, B, A, \text{TraceID}, \text{SpanID}, F)
\]

å…¶ä¸­ï¼š

- \( T \in \mathbb{T} \): Timestamp (å¯é€‰)
- \( T_{obs} \in \mathbb{T} \): ObservedTimestamp (å¿…éœ€)
- \( S_n \in [0, 24] \): SeverityNumber
- \( S_t \in \text{String} \): SeverityText
- \( B \in \mathbb{V} \): Body (AnyValue)
- \( A \subseteq \mathbb{K} \times \mathbb{V} \): Attributes
- \( \text{TraceID} \in \{0,1\}^{128} \): è¿½è¸ª ID
- \( \text{SpanID} \in \{0,1\}^{64} \): Span ID
- \( F \in \{0,1\}^{32} \): TraceFlags

### 2. æ—¶é—´æˆ³å®šä¹‰

**å®šä¹‰ 1.2 (æ—¶é—´åŸŸ)**:

\[
\mathbb{T} = \{t \in \mathbb{N} \mid 0 \leq t < 2^{64}\}
\]

æ—¶é—´æˆ³ä¸º Unix çº³ç§’ (uint64)ã€‚

**æ€§è´¨**:

- å•è°ƒé€’å¢ (å¯¹äºåŒä¸€æº)
- ç²¾åº¦: çº³ç§’çº§

### 3. SeverityNumber å®šä¹‰

**å®šä¹‰ 1.3 (SeverityNumber)**:

\[
S_n \in \{0, 1, 2, ..., 24\}
\]

çº§åˆ«æ˜ å°„ï¼š
\[
\begin{aligned}
\text{TRACE} &\mapsto [1, 4] \\
\text{DEBUG} &\mapsto [5, 8] \\
\text{INFO} &\mapsto [9, 12] \\
\text{WARN} &\mapsto [13, 16] \\
\text{ERROR} &\mapsto [17, 20] \\
\text{FATAL} &\mapsto [21, 24]
\end{aligned}
\]

### 4. AnyValue å®šä¹‰

**å®šä¹‰ 1.4 (AnyValue)**:

AnyValue æ˜¯ä¸€ä¸ªä»£æ•°æ•°æ®ç±»å‹ï¼š

\[
\mathbb{V} = \text{String} \mid \text{Int} \mid \text{Float} \mid \text{Bool} \mid \text{Bytes} \mid \text{Array} \mid \text{KvList}
\]

å…¶ä¸­ï¼š

- \( \text{String} \subseteq \Sigma^* \) (å­—ç¬¦ä¸²)
- \( \text{Int} \subseteq \mathbb{Z} \) (æ•´æ•°)
- \( \text{Float} \subseteq \mathbb{R} \) (æµ®ç‚¹æ•°)
- \( \text{Bool} = \{\text{true}, \text{false}\} \) (å¸ƒå°”)
- \( \text{Bytes} \subseteq \{0,1\}^* \) (å­—èŠ‚åºåˆ—)
- \( \text{Array} = \mathbb{V}^* \) (æ•°ç»„)
- \( \text{KvList} = (\mathbb{K} \times \mathbb{V})^* \) (é”®å€¼å¯¹åˆ—è¡¨)

---

## LogRecord çš„å½¢å¼åŒ–

### 1. å®Œæ•´å®šä¹‰

**å®šä¹‰ 2.1 (LogRecord é›†åˆ)**:

LogRecord çš„é›†åˆå®šä¹‰ä¸ºï¼š

\[
\mathcal{LR} = \{(T, T_{obs}, S_n, S_t, B, A, \text{TID}, \text{SID}, F) \mid \text{Valid}(T, T_{obs}, S_n, A)\}
\]

### 2. æœ‰æ•ˆæ€§æ¡ä»¶

**å®šä¹‰ 2.2 (Valid)**:

LogRecord æœ‰æ•ˆå½“ä¸”ä»…å½“ï¼š

\[
\begin{aligned}
\text{Valid}(LR) \iff & \ T_{obs} \neq \emptyset \\
& \land (T = \emptyset \lor T \leq T_{obs}) \\
& \land S_n \in [0, 24] \\
& \land |A| \leq \text{MaxAttributes} \\
& \land \forall (k, v) \in A: k \neq \emptyset
\end{aligned}
\]

**æ¡ä»¶è¯´æ˜**:

1. ObservedTimestamp å¿…é¡»å­˜åœ¨
2. å¦‚æœ Timestamp å­˜åœ¨ï¼Œå¿…é¡» â‰¤ ObservedTimestamp
3. SeverityNumber åœ¨æœ‰æ•ˆèŒƒå›´å†…
4. Attributes æ•°é‡ä¸è¶…è¿‡é™åˆ¶
5. æ‰€æœ‰å±æ€§é”®éç©º

---

## SeverityNumber çš„å½¢å¼åŒ–

### 1. å…¨åºå…³ç³»

**å®šä¹‰ 3.1 (SeverityNumber å…¨åº)**:

åœ¨ SeverityNumber ä¸Šå®šä¹‰å…¨åºå…³ç³» \( \leq \)ï¼š

\[
\forall s_1, s_2 \in [0, 24]: s_1 \leq s_2 \iff s_1 \text{ çš„æ•°å€¼} \leq s_2 \text{ çš„æ•°å€¼}
\]

**æ€§è´¨**:

- **è‡ªåæ€§**: \( \forall s: s \leq s \)
- **åå¯¹ç§°æ€§**: \( s_1 \leq s_2 \land s_2 \leq s_1 \Rightarrow s_1 = s_2 \)
- **ä¼ é€’æ€§**: \( s_1 \leq s_2 \land s_2 \leq s_3 \Rightarrow s_1 \leq s_3 \)
- **å®Œå…¨æ€§**: \( \forall s_1, s_2: s_1 \leq s_2 \lor s_2 \leq s_1 \)

### 2. çº§åˆ«æ˜ å°„

**å®šä¹‰ 3.2 (çº§åˆ«æ˜ å°„å‡½æ•°)**:

å®šä¹‰æ˜ å°„å‡½æ•° \( \text{Level}: [0, 24] \rightarrow \{\text{TRACE}, \text{DEBUG}, \text{INFO}, \text{WARN}, \text{ERROR}, \text{FATAL}\} \)ï¼š

\[
\text{Level}(s) = \begin{cases}
\text{TRACE} & \text{if } 1 \leq s \leq 4 \\
\text{DEBUG} & \text{if } 5 \leq s \leq 8 \\
\text{INFO} & \text{if } 9 \leq s \leq 12 \\
\text{WARN} & \text{if } 13 \leq s \leq 16 \\
\text{ERROR} & \text{if } 17 \leq s \leq 20 \\
\text{FATAL} & \text{if } 21 \leq s \leq 24 \\
\text{UNSPECIFIED} & \text{if } s = 0
\end{cases}
\]

**å®šç† 3.1 (çº§åˆ«ä¿åº)**:

çº§åˆ«æ˜ å°„ä¿æŒååºå…³ç³»ï¼š

\[
\forall s_1, s_2: \text{Level}(s_1) \leq \text{Level}(s_2) \Leftarrow s_1 \leq s_2
\]

---

## Body å’Œ Attributes çš„å½¢å¼åŒ–

### 1. Body å®šä¹‰

**å®šä¹‰ 4.1 (Body æœ‰æ•ˆæ€§)**:

Body æœ‰æ•ˆå½“ä¸”ä»…å½“ï¼š

\[
\text{ValidBody}(B) \iff |B| \leq \text{MaxBodySize}
\]

å…¶ä¸­ \( |B| \) æ˜¯ Body çš„åºåˆ—åŒ–å¤§å°ã€‚

### 2. Attributes å®šä¹‰

**å®šä¹‰ 4.2 (Attributes é›†åˆ)**:

Attributes æ˜¯é”®å€¼å¯¹çš„æœ‰é™é›†åˆï¼š

\[
A = \{(k_1, v_1), (k_2, v_2), ..., (k_n, v_n)\}
\]

æ»¡è¶³ï¼š

- \( \forall i \neq j: k_i \neq k_j \) (é”®å”¯ä¸€)
- \( n \leq \text{MaxAttributes} \) (æ•°é‡é™åˆ¶)

### 3. å±æ€§æ“ä½œ

**å®šä¹‰ 4.3 (å±æ€§åˆå¹¶)**:

å®šä¹‰åˆå¹¶æ“ä½œ \( \oplus: \mathcal{A} \times \mathcal{A} \rightarrow \mathcal{A} \)ï¼š

\[
A_1 \oplus A_2 = \{(k, v) \mid (k, v) \in A_1 \lor ((k, v) \in A_2 \land k \notin \text{keys}(A_1))\}
\]

**æ€§è´¨**:

- **å¹‚ç­‰æ€§**: \( A \oplus A = A \)
- **ç»“åˆæ€§**: \( (A_1 \oplus A_2) \oplus A_3 = A_1 \oplus (A_2 \oplus A_3) \)
- **å·¦ä¼˜å…ˆ**: å¦‚æœ \( k \in \text{keys}(A_1) \cap \text{keys}(A_2) \)ï¼Œåˆ™ä½¿ç”¨ \( A_1 \) ä¸­çš„å€¼

**å®šä¹‰ 4.4 (å±æ€§è¿‡æ»¤)**:

å®šä¹‰è¿‡æ»¤æ“ä½œ \( \text{filter}: \mathcal{A} \times (\mathbb{K} \rightarrow \{\text{true}, \text{false}\}) \rightarrow \mathcal{A} \)ï¼š

\[
\text{filter}(A, P) = \{(k, v) \in A \mid P(k)\}
\]

---

## ä¸å˜é‡

### 1. æ—¶é—´ä¸å˜é‡

**ä¸å˜é‡ 5.1 (æ—¶é—´æœ‰åºæ€§)**:

\[
T \neq \emptyset \Rightarrow T \leq T_{obs}
\]

å³ï¼šå¦‚æœ Timestamp å­˜åœ¨ï¼Œå¿…é¡»æ—©äºæˆ–ç­‰äº ObservedTimestampã€‚

**ä¸å˜é‡ 5.2 (ObservedTimestamp éç©º)**:

\[
\forall LR \in \mathcal{LR}: T_{obs} \neq \emptyset
\]

å³ï¼šæ‰€æœ‰ LogRecord å¿…é¡»æœ‰ ObservedTimestampã€‚

### 2. ä¸¥é‡æ€§ä¸å˜é‡

**ä¸å˜é‡ 5.3 (SeverityNumber èŒƒå›´)**:

\[
\forall LR \in \mathcal{LR}: S_n \in [0, 24]
\]

**ä¸å˜é‡ 5.4 (SeverityText ä¸€è‡´æ€§)**:

\[
S_n \neq 0 \Rightarrow S_t = \text{Level}(S_n).\text{String}()
\]

å³ï¼šå¦‚æœ SeverityNumber æœ‰æ•ˆï¼ŒSeverityText åº”è¯¥å¯¹åº”ã€‚

### 3. å±æ€§ä¸å˜é‡

**ä¸å˜é‡ 5.5 (å±æ€§é”®å”¯ä¸€æ€§)**:

\[
\forall (k_1, v_1), (k_2, v_2) \in A: k_1 = k_2 \Rightarrow (k_1, v_1) = (k_2, v_2)
\]

**ä¸å˜é‡ 5.6 (å±æ€§æ•°é‡é™åˆ¶)**:

\[
|A| \leq \text{MaxAttributes}
\]

**ä¸å˜é‡ 5.7 (ä¸¢å¼ƒè®¡æ•°ä¸€è‡´æ€§)**:

\[
\text{DroppedAttributesCount} = \text{åŸå§‹å±æ€§æ•°é‡} - |A|
\]

---

## æ­£ç¡®æ€§è¯æ˜

### 1. æ—¶é—´æˆ³ä¸€è‡´æ€§

**å®šç† 6.1 (æ—¶é—´æˆ³ä¸€è‡´æ€§)**:

å¯¹äºä»»æ„æœ‰æ•ˆçš„ LogRecordï¼Œå¦‚æœ Timestamp å­˜åœ¨ï¼Œåˆ™ï¼š

\[
T \leq T_{obs}
\]

**è¯æ˜**:

ç”±æœ‰æ•ˆæ€§æ¡ä»¶ (å®šä¹‰ 2.2)ï¼š

\[
\text{Valid}(LR) \Rightarrow (T = \emptyset \lor T \leq T_{obs})
\]

å¦‚æœ \( T \neq \emptyset \)ï¼Œåˆ™å¿…æœ‰ \( T \leq T_{obs} \)ã€‚âˆ

### 2. ä¸¥é‡æ€§æœ‰åºæ€§

**å®šç† 6.2 (ä¸¥é‡æ€§è¿‡æ»¤æ­£ç¡®æ€§)**:

ç»™å®šæœ€å°ä¸¥é‡æ€§ \( S_{min} \)ï¼Œè¿‡æ»¤åçš„ LogRecord é›†åˆæ»¡è¶³ï¼š

\[
\mathcal{LR}' = \{LR \in \mathcal{LR} \mid S_n \geq S_{min}\}
\]

åˆ™ï¼š

\[
\forall LR \in \mathcal{LR}': S_n \geq S_{min}
\]

**è¯æ˜**:

ç”±é›†åˆå®šä¹‰ï¼Œ\( \mathcal{LR}' \) ä»…åŒ…å«æ»¡è¶³ \( S_n \geq S_{min} \) çš„ LogRecordã€‚

å› æ­¤ï¼Œ\( \forall LR \in \mathcal{LR}': S_n \geq S_{min} \)ã€‚âˆ

### 3. å±æ€§åˆå¹¶æ­£ç¡®æ€§

**å®šç† 6.3 (å±æ€§åˆå¹¶å¹‚ç­‰æ€§)**:

\[
\forall A: A \oplus A = A
\]

**è¯æ˜**:

\[
\begin{aligned}
A \oplus A &= \{(k, v) \mid (k, v) \in A \lor ((k, v) \in A \land k \notin \text{keys}(A))\} \\
&= \{(k, v) \mid (k, v) \in A \lor \text{false}\} \\
&= \{(k, v) \mid (k, v) \in A\} \\
&= A
\end{aligned}
\]

âˆ

**å®šç† 6.4 (å±æ€§åˆå¹¶ç»“åˆæ€§)**:

\[
(A_1 \oplus A_2) \oplus A_3 = A_1 \oplus (A_2 \oplus A_3)
\]

**è¯æ˜**:

å¯¹äºä»»æ„é”® \( k \)ï¼š

- å¦‚æœ \( k \in \text{keys}(A_1) \)ï¼Œåˆ™ï¼š
  - å·¦ä¾§: \( (A_1 \oplus A_2) \oplus A_3 \) ä½¿ç”¨ \( A_1 \) çš„å€¼
  - å³ä¾§: \( A_1 \oplus (A_2 \oplus A_3) \) ä½¿ç”¨ \( A_1 \) çš„å€¼
  - ç»“æœç›¸åŒ

- å¦‚æœ \( k \notin \text{keys}(A_1) \land k \in \text{keys}(A_2) \)ï¼Œåˆ™ï¼š
  - å·¦ä¾§: ä½¿ç”¨ \( A_2 \) çš„å€¼
  - å³ä¾§: ä½¿ç”¨ \( A_2 \) çš„å€¼
  - ç»“æœç›¸åŒ

- å¦‚æœ \( k \notin \text{keys}(A_1) \land k \notin \text{keys}(A_2) \)ï¼Œåˆ™ï¼š
  - å·¦ä¾§: ä½¿ç”¨ \( A_3 \) çš„å€¼ (å¦‚æœå­˜åœ¨)
  - å³ä¾§: ä½¿ç”¨ \( A_3 \) çš„å€¼ (å¦‚æœå­˜åœ¨)
  - ç»“æœç›¸åŒ

å› æ­¤ï¼Œç»“åˆæ€§æˆç«‹ã€‚âˆ

---

## æ€§èƒ½åˆ†æ

### 1. æ—¶é—´å¤æ‚åº¦

**å®šç† 7.1 (LogRecord åˆ›å»ºå¤æ‚åº¦)**:

åˆ›å»º LogRecord çš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼š

\[
T_{\text{create}}(n) = O(n)
\]

å…¶ä¸­ \( n = |A| \) æ˜¯å±æ€§æ•°é‡ã€‚

**è¯æ˜**:

```text
åˆ›å»º LogRecord:
  è®¾ç½®å­—æ®µ:         O(1)
  å¤åˆ¶ Attributes:  O(n)
  
æ€»å¤æ‚åº¦: O(n)  âœ“
```

**å®šç† 7.2 (å±æ€§åˆå¹¶å¤æ‚åº¦)**:

åˆå¹¶ä¸¤ä¸ªå±æ€§é›†åˆçš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼š

\[
T_{\text{merge}}(n_1, n_2) = O(n_1 + n_2)
\]

**è¯æ˜**:

```text
å±æ€§åˆå¹¶:
  éå† Aâ‚:  O(nâ‚)
  éå† Aâ‚‚:  O(nâ‚‚)
  
æ€»å¤æ‚åº¦: O(nâ‚ + nâ‚‚)  âœ“
```

**å®šç† 7.3 (ä¸¥é‡æ€§æ¯”è¾ƒå¤æ‚åº¦)**:

æ¯”è¾ƒä¸¤ä¸ª SeverityNumber çš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼š

\[
T_{\text{compare}} = O(1)
\]

**è¯æ˜**: æ•´æ•°æ¯”è¾ƒä¸ºå¸¸æ•°æ—¶é—´æ“ä½œã€‚âˆ

### 2. ç©ºé—´å¤æ‚åº¦

**å®šç† 7.4 (LogRecord ç©ºé—´å¤æ‚åº¦)**:

LogRecord çš„ç©ºé—´å¤æ‚åº¦ä¸ºï¼š

\[
S_{\text{LR}}(n, m) = O(n + m)
\]

å…¶ä¸­ï¼š

- \( n = |A| \): å±æ€§æ•°é‡
- \( m = |B| \): Body å¤§å°

**è¯æ˜**:

```text
LogRecord å­˜å‚¨:
  å›ºå®šå­—æ®µ:        O(1)  (Timestamp, SeverityNumber, etc.)
  Body:            O(m)
  Attributes:      O(n)
  
æ€»ç©ºé—´: O(n + m)  âœ“
```

---

## TLA+ è§„èŒƒ

```tla
--------------------------- MODULE Logs ---------------------------
EXTENDS Naturals, Sequences, TLC

CONSTANTS MaxAttributes, MaxSeverity

VARIABLES 
    logs,           \* æ—¥å¿—åºåˆ—
    observedTime    \* è§‚æµ‹æ—¶é—´

TypeInvariant ==
    /\ logs \in Seq([
        timestamp: Nat,
        observedTimestamp: Nat,
        severityNumber: 0..MaxSeverity,
        body: STRING,
        attributes: [STRING -> STRING]
    ])
    /\ observedTime \in Nat

Init ==
    /\ logs = <<>>
    /\ observedTime = 0

AddLog(timestamp, severity, body, attrs) ==
    /\ observedTime' = observedTime + 1
    /\ logs' = Append(logs, [
        timestamp |-> timestamp,
        observedTimestamp |-> observedTime',
        severityNumber |-> severity,
        body |-> body,
        attributes |-> attrs
    ])

\* ä¸å˜é‡ï¼šObservedTimestamp é€’å¢
ObservedTimestampMonotonic ==
    \A i, j \in DOMAIN logs:
        i < j => logs[i].observedTimestamp < logs[j].observedTimestamp

\* ä¸å˜é‡ï¼šTimestamp <= ObservedTimestamp
TimestampConsistency ==
    \A i \in DOMAIN logs:
        logs[i].timestamp <= logs[i].observedTimestamp

\* ä¸å˜é‡ï¼šSeverityNumber èŒƒå›´
SeverityRange ==
    \A i \in DOMAIN logs:
        logs[i].severityNumber \in 0..MaxSeverity

\* ä¸å˜é‡ï¼šAttributes æ•°é‡é™åˆ¶
AttributesLimit ==
    \A i \in DOMAIN logs:
        Cardinality(DOMAIN logs[i].attributes) <= MaxAttributes

Spec == Init /\ [][AddLog]_<<logs, observedTime>>

THEOREM Spec => []TypeInvariant
THEOREM Spec => []ObservedTimestampMonotonic
THEOREM Spec => []TimestampConsistency
THEOREM Spec => []SeverityRange
THEOREM Spec => []AttributesLimit
=====================================================================
```

---

## Go å®ç°éªŒè¯

### 1. ç±»å‹å®‰å…¨

```go
// Go ç±»å‹ç³»ç»Ÿä¿è¯
type LogRecord struct {
    Timestamp         time.Time  // è‡ªåŠ¨ç±»å‹æ£€æŸ¥
    ObservedTimestamp time.Time  // å¿…éœ€å­—æ®µ
    SeverityNumber    SeverityNumber // æšä¸¾ç±»å‹
    Body              *AnyValue  // ç±»å‹å®‰å…¨çš„å€¼
    Attributes        map[string]*AnyValue // ç±»å‹å®‰å…¨çš„å±æ€§
}

// ç¼–è¯‘æ—¶æ£€æŸ¥
func NewLogRecord() *LogRecord {
    return &LogRecord{
        ObservedTimestamp: time.Now(), // å¿…éœ€å­—æ®µè‡ªåŠ¨è®¾ç½®
        Attributes:        make(map[string]*AnyValue),
    }
}
```

### 2. å¹¶å‘å®‰å…¨

```go
// ä½¿ç”¨äº’æ–¥é”ä¿è¯å¹¶å‘å®‰å…¨
type SafeLogger struct {
    records []*LogRecord
    mu      sync.RWMutex
}

func (l *SafeLogger) Add(record *LogRecord) {
    l.mu.Lock()
    defer l.mu.Unlock()
    l.records = append(l.records, record)
}

func (l *SafeLogger) GetAll() []*LogRecord {
    l.mu.RLock()
    defer l.mu.RUnlock()
    
    // è¿”å›å‰¯æœ¬ï¼Œé¿å…å¹¶å‘ä¿®æ”¹
    result := make([]*LogRecord, len(l.records))
    copy(result, l.records)
    return result
}

// å®šç†ï¼šå¹¶å‘å®‰å…¨æ€§
// å¤šä¸ª goroutine åŒæ—¶è°ƒç”¨ Add() å’Œ GetAll() ä¸ä¼šå¯¼è‡´æ•°æ®ç«äº‰
```

---

## å‚è€ƒèµ„æº

- [OpenTelemetry Logs Data Model](https://opentelemetry.io/docs/specs/otel/logs/data-model/)
- [TLA+ Specification](https://lamport.azurewebsites.net/tla/tla.html)
- [01_LogRecordç»“æ„.md](./01_LogRecordç»“æ„.md)
- [02_SeverityNumber.md](./02_SeverityNumber.md)
- [03_Bodyä¸Attributes.md](./03_Bodyä¸Attributes.md)

---

**ğŸ‰ æ­å–œï¼ä½ å·²ç»å®Œæˆäº† Logs æ•°æ®æ¨¡å‹çš„å½¢å¼åŒ–å®šä¹‰ï¼**

æœ¬æ–‡æ¡£æä¾›äº†ï¼š

- âœ… å®Œæ•´çš„æ•°å­¦å®šä¹‰
- âœ… ä¸¥æ ¼çš„ä¸å˜é‡åˆ†æ
- âœ… æ­£ç¡®æ€§è¯æ˜
- âœ… æ€§èƒ½å¤æ‚åº¦åˆ†æ
- âœ… TLA+ å½¢å¼åŒ–è§„èŒƒ
- âœ… Go å®ç°éªŒè¯

**Phase 3.3: Logs æ•°æ®æ¨¡å‹ å…¨éƒ¨å®Œæˆï¼** ğŸŠ

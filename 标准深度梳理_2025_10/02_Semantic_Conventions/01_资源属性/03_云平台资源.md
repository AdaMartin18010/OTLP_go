# äº‘å¹³å°èµ„æºå±æ€§ (Cloud Platform Resource Attributes)

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
> **OpenTelemetry ç‰ˆæœ¬**: v1.32.0  
> **è¯­ä¹‰çº¦å®šç‰ˆæœ¬**: v1.28.0  
> **æœ€åæ›´æ–°**: 2025å¹´10æœˆ9æ—¥

---

## ğŸ“‹ ç›®å½•

- [äº‘å¹³å°èµ„æºå±æ€§ (Cloud Platform Resource Attributes)](#äº‘å¹³å°èµ„æºå±æ€§-cloud-platform-resource-attributes)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [æ¦‚è¿°](#æ¦‚è¿°)
    - [äº‘èµ„æºçš„å®šä¹‰](#äº‘èµ„æºçš„å®šä¹‰)
    - [ä¸ºä»€ä¹ˆéœ€è¦äº‘å¹³å°å±æ€§?](#ä¸ºä»€ä¹ˆéœ€è¦äº‘å¹³å°å±æ€§)
  - [é€šç”¨äº‘å±æ€§](#é€šç”¨äº‘å±æ€§)
    - [æ ¸å¿ƒå±æ€§](#æ ¸å¿ƒå±æ€§)
    - [äº‘æœåŠ¡æä¾›å•†æšä¸¾](#äº‘æœåŠ¡æä¾›å•†æšä¸¾)
  - [AWS å±æ€§](#aws-å±æ€§)
    - [1. AWS æ ¸å¿ƒå±æ€§](#1-aws-æ ¸å¿ƒå±æ€§)
    - [2. AWS å¹³å°ç±»å‹](#2-aws-å¹³å°ç±»å‹)
    - [3. AWS EC2 ç¤ºä¾‹](#3-aws-ec2-ç¤ºä¾‹)
    - [4. AWS ECS ç¤ºä¾‹](#4-aws-ecs-ç¤ºä¾‹)
    - [5. AWS Lambda ç¤ºä¾‹](#5-aws-lambda-ç¤ºä¾‹)
  - [Azure å±æ€§](#azure-å±æ€§)
    - [1. Azure æ ¸å¿ƒå±æ€§](#1-azure-æ ¸å¿ƒå±æ€§)
    - [2. Azure å¹³å°ç±»å‹](#2-azure-å¹³å°ç±»å‹)
    - [3. Azure VM ç¤ºä¾‹](#3-azure-vm-ç¤ºä¾‹)
    - [4. Azure AKS ç¤ºä¾‹](#4-azure-aks-ç¤ºä¾‹)
    - [5. Azure Functions ç¤ºä¾‹](#5-azure-functions-ç¤ºä¾‹)
  - [GCP å±æ€§](#gcp-å±æ€§)
    - [1. GCP æ ¸å¿ƒå±æ€§](#1-gcp-æ ¸å¿ƒå±æ€§)
    - [2. GCP å¹³å°ç±»å‹](#2-gcp-å¹³å°ç±»å‹)
    - [3. GCP Compute Engine ç¤ºä¾‹](#3-gcp-compute-engine-ç¤ºä¾‹)
    - [4. GCP GKE ç¤ºä¾‹](#4-gcp-gke-ç¤ºä¾‹)
    - [5. GCP Cloud Run ç¤ºä¾‹](#5-gcp-cloud-run-ç¤ºä¾‹)
  - [Go å®ç°](#go-å®ç°)
    - [1. äº‘å¹³å°è‡ªåŠ¨æ£€æµ‹](#1-äº‘å¹³å°è‡ªåŠ¨æ£€æµ‹)
    - [2. AWS èµ„æºæ£€æµ‹](#2-aws-èµ„æºæ£€æµ‹)
    - [3. Azure èµ„æºæ£€æµ‹](#3-azure-èµ„æºæ£€æµ‹)
    - [4. GCP èµ„æºæ£€æµ‹](#4-gcp-èµ„æºæ£€æµ‹)
  - [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
    - [1. äº‘å¹³å°æ£€æµ‹ä¼˜å…ˆçº§](#1-äº‘å¹³å°æ£€æµ‹ä¼˜å…ˆçº§)
    - [2. è¶…æ—¶è®¾ç½®](#2-è¶…æ—¶è®¾ç½®)
    - [3. ç¼“å­˜å…ƒæ•°æ®](#3-ç¼“å­˜å…ƒæ•°æ®)
  - [å‚è€ƒèµ„æº](#å‚è€ƒèµ„æº)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)

---

## æ¦‚è¿°

### äº‘èµ„æºçš„å®šä¹‰

**å½¢å¼åŒ–å®šä¹‰**:

```text
CloudResource = (Provider, Platform, Region, Zone, AccountId, ResourceId)

å…¶ä¸­:
- Provider: äº‘æœåŠ¡æä¾›å•† (aws, azure, gcp)
- Platform: äº‘å¹³å°æœåŠ¡ (ec2, ecs, lambda, aks, gke ç­‰)
- Region: äº‘åŒºåŸŸ
- Zone: å¯ç”¨åŒº
- AccountId: è´¦æˆ·/è®¢é˜…/é¡¹ç›® ID
- ResourceId: èµ„æºå”¯ä¸€æ ‡è¯†
```

### ä¸ºä»€ä¹ˆéœ€è¦äº‘å¹³å°å±æ€§?

```text
1. å¤šäº‘ç®¡ç†
   - ç»Ÿä¸€çš„äº‘èµ„æºæ ‡è¯†
   - è·¨äº‘å¹³å°æ•°æ®åˆ†æ

2. æˆæœ¬åˆ†æ
   - æŒ‰è´¦æˆ·/åŒºåŸŸèšåˆæˆæœ¬
   - èµ„æºä½¿ç”¨ä¼˜åŒ–

3. æ•…éšœå®šä½
   - å¿«é€Ÿå®šä½ç‰¹å®šäº‘èµ„æº
   - åŒºåŸŸçº§åˆ«æ•…éšœåˆ†æ

4. åˆè§„å®¡è®¡
   - è·Ÿè¸ªäº‘èµ„æºè®¿é—®
   - æ•°æ®ä¸»æƒåˆè§„æ€§

5. å®¹é‡è§„åˆ’
   - åŒºåŸŸçº§åˆ«è´Ÿè½½åˆ†æ
   - è‡ªåŠ¨æ‰©ç¼©å®¹å†³ç­–
```

---

## é€šç”¨äº‘å±æ€§

### æ ¸å¿ƒå±æ€§

| å±æ€§å | ç±»å‹ | å¿…éœ€æ€§ | æè¿° | ç¤ºä¾‹ |
|-------|------|--------|------|------|
| `cloud.provider` | string | **å¿…éœ€** | äº‘æœåŠ¡æä¾›å•† | `aws`, `azure`, `gcp` |
| `cloud.platform` | string | æ¨è | äº‘å¹³å°æœåŠ¡ | `aws_ec2`, `azure_vm` |
| `cloud.region` | string | æ¨è | äº‘åŒºåŸŸ | `us-east-1`, `eastus` |
| `cloud.availability_zone` | string | å¯é€‰ | å¯ç”¨åŒº | `us-east-1a` |
| `cloud.account.id` | string | æ¨è | è´¦æˆ· ID | `123456789012` |
| `cloud.resource_id` | string | æ¨è | èµ„æº ID | `i-1234567890abcdef0` |

### äº‘æœåŠ¡æä¾›å•†æšä¸¾

```text
æ”¯æŒçš„äº‘æœåŠ¡æä¾›å•†:

aws        - Amazon Web Services
azure      - Microsoft Azure
gcp        - Google Cloud Platform
alibaba    - Alibaba Cloud
tencent    - Tencent Cloud
```

---

## AWS å±æ€§

### 1. AWS æ ¸å¿ƒå±æ€§

| å±æ€§å | ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|-------|------|------|------|
| `cloud.provider` | string | å›ºå®šå€¼ `aws` | `aws` |
| `cloud.platform` | string | AWS æœåŠ¡ç±»å‹ | `aws_ec2`, `aws_ecs` |
| `cloud.region` | string | AWS åŒºåŸŸ | `us-east-1` |
| `cloud.availability_zone` | string | AWS å¯ç”¨åŒº | `us-east-1a` |
| `cloud.account.id` | string | AWS è´¦æˆ· ID | `123456789012` |

### 2. AWS å¹³å°ç±»å‹

```text
è®¡ç®—æœåŠ¡:
  aws_ec2          - Amazon EC2
  aws_ecs          - Amazon ECS
  aws_eks          - Amazon EKS
  aws_lambda       - AWS Lambda
  aws_elastic_beanstalk - Elastic Beanstalk

å®¹å™¨æœåŠ¡:
  aws_ecs          - ECS (Elastic Container Service)
  aws_eks          - EKS (Elastic Kubernetes Service)
  aws_fargate      - AWS Fargate

æ— æœåŠ¡å™¨:
  aws_lambda       - AWS Lambda
  aws_app_runner   - AWS App Runner
```

### 3. AWS EC2 ç¤ºä¾‹

```go
// AWS EC2 å®ä¾‹èµ„æºå±æ€§
cloud.provider           = "aws"
cloud.platform           = "aws_ec2"
cloud.region             = "us-east-1"
cloud.availability_zone  = "us-east-1a"
cloud.account.id         = "123456789012"
cloud.resource_id        = "i-1234567890abcdef0"

// è¡¥å……å±æ€§ (è‡ªå®šä¹‰æˆ–ä» host è·å–)
host.id                  = "i-1234567890abcdef0"
host.type                = "t3.large"
host.image.id            = "ami-0abcdef1234567890"
```

### 4. AWS ECS ç¤ºä¾‹

```go
// AWS ECS ä»»åŠ¡èµ„æºå±æ€§
cloud.provider           = "aws"
cloud.platform           = "aws_ecs"
cloud.region             = "us-east-1"
cloud.availability_zone  = "us-east-1a"
cloud.account.id         = "123456789012"

// ECS ç‰¹å®šå±æ€§ (éœ€è¦è‡ªå®šä¹‰æˆ–ä½¿ç”¨ container.* å±æ€§)
aws.ecs.container.arn    = "arn:aws:ecs:us-east-1:123456789012:container/..."
aws.ecs.task.arn         = "arn:aws:ecs:us-east-1:123456789012:task/..."
aws.ecs.task.family      = "my-task-family"
aws.ecs.cluster.arn      = "arn:aws:ecs:us-east-1:123456789012:cluster/my-cluster"
```

### 5. AWS Lambda ç¤ºä¾‹

```go
// AWS Lambda å‡½æ•°èµ„æºå±æ€§
cloud.provider           = "aws"
cloud.platform           = "aws_lambda"
cloud.region             = "us-east-1"
cloud.account.id         = "123456789012"

// Lambda ç‰¹å®šå±æ€§
faas.name                = "my-function"
faas.version             = "$LATEST"
faas.instance            = "2021/06/28/[$LATEST]abcdef1234567890"
```

---

## Azure å±æ€§

### 1. Azure æ ¸å¿ƒå±æ€§

| å±æ€§å | ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|-------|------|------|------|
| `cloud.provider` | string | å›ºå®šå€¼ `azure` | `azure` |
| `cloud.platform` | string | Azure æœåŠ¡ç±»å‹ | `azure_vm`, `azure_aks` |
| `cloud.region` | string | Azure åŒºåŸŸ | `eastus`, `westeurope` |
| `cloud.account.id` | string | Azure è®¢é˜… ID | `00000000-0000-0000-0000-000000000000` |
| `cloud.resource_id` | string | Azure èµ„æº ID | `/subscriptions/.../resourceGroups/.../providers/...` |

### 2. Azure å¹³å°ç±»å‹

```text
è®¡ç®—æœåŠ¡:
  azure_vm             - Azure Virtual Machines
  azure_container_instances - Azure Container Instances
  azure_aks            - Azure Kubernetes Service
  azure_functions      - Azure Functions
  azure_app_service    - Azure App Service

å®¹å™¨æœåŠ¡:
  azure_aks            - AKS (Azure Kubernetes Service)
  azure_container_instances - ACI
  azure_container_apps - Azure Container Apps
```

### 3. Azure VM ç¤ºä¾‹

```go
// Azure VM èµ„æºå±æ€§
cloud.provider           = "azure"
cloud.platform           = "azure_vm"
cloud.region             = "eastus"
cloud.account.id         = "00000000-0000-0000-0000-000000000000"
cloud.resource_id        = "/subscriptions/00000000.../resourceGroups/my-rg/providers/Microsoft.Compute/virtualMachines/my-vm"

// è¡¥å……å±æ€§
host.id                  = "my-vm"
host.type                = "Standard_D2s_v3"
azure.resourcegroup.name = "my-rg"
```

### 4. Azure AKS ç¤ºä¾‹

```go
// Azure AKS èµ„æºå±æ€§
cloud.provider           = "azure"
cloud.platform           = "azure_aks"
cloud.region             = "eastus"
cloud.account.id         = "00000000-0000-0000-0000-000000000000"

// AKS ç‰¹å®šå±æ€§
k8s.cluster.name         = "my-aks-cluster"
azure.resourcegroup.name = "my-rg"
```

### 5. Azure Functions ç¤ºä¾‹

```go
// Azure Functions èµ„æºå±æ€§
cloud.provider           = "azure"
cloud.platform           = "azure_functions"
cloud.region             = "eastus"
cloud.account.id         = "00000000-0000-0000-0000-000000000000"

// Functions ç‰¹å®šå±æ€§
faas.name                = "my-function"
faas.version             = "1.0.0"
azure.resourcegroup.name = "my-rg"
```

---

## GCP å±æ€§

### 1. GCP æ ¸å¿ƒå±æ€§

| å±æ€§å | ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|-------|------|------|------|
| `cloud.provider` | string | å›ºå®šå€¼ `gcp` | `gcp` |
| `cloud.platform` | string | GCP æœåŠ¡ç±»å‹ | `gcp_compute_engine` |
| `cloud.region` | string | GCP åŒºåŸŸ | `us-central1` |
| `cloud.availability_zone` | string | GCP å¯ç”¨åŒº | `us-central1-a` |
| `cloud.account.id` | string | GCP é¡¹ç›® ID | `my-project-123456` |
| `cloud.resource_id` | string | GCP èµ„æº ID | `1234567890` |

### 2. GCP å¹³å°ç±»å‹

```text
è®¡ç®—æœåŠ¡:
  gcp_compute_engine   - Google Compute Engine (GCE)
  gcp_cloud_run        - Cloud Run
  gcp_cloud_functions  - Cloud Functions
  gcp_app_engine       - App Engine
  gcp_kubernetes_engine - Google Kubernetes Engine (GKE)

å®¹å™¨æœåŠ¡:
  gcp_kubernetes_engine - GKE
  gcp_cloud_run        - Cloud Run
```

### 3. GCP Compute Engine ç¤ºä¾‹

```go
// GCP Compute Engine å®ä¾‹èµ„æºå±æ€§
cloud.provider           = "gcp"
cloud.platform           = "gcp_compute_engine"
cloud.region             = "us-central1"
cloud.availability_zone  = "us-central1-a"
cloud.account.id         = "my-project-123456"
cloud.resource_id        = "1234567890"

// è¡¥å……å±æ€§
host.id                  = "1234567890"
host.name                = "my-instance"
host.type                = "n1-standard-4"
```

### 4. GCP GKE ç¤ºä¾‹

```go
// GCP GKE èµ„æºå±æ€§
cloud.provider           = "gcp"
cloud.platform           = "gcp_kubernetes_engine"
cloud.region             = "us-central1"
cloud.account.id         = "my-project-123456"

// GKE ç‰¹å®šå±æ€§
k8s.cluster.name         = "my-gke-cluster"
gcp.gke.cluster.location = "us-central1"
```

### 5. GCP Cloud Run ç¤ºä¾‹

```go
// GCP Cloud Run èµ„æºå±æ€§
cloud.provider           = "gcp"
cloud.platform           = "gcp_cloud_run"
cloud.region             = "us-central1"
cloud.account.id         = "my-project-123456"

// Cloud Run ç‰¹å®šå±æ€§
faas.name                = "my-service"
faas.version             = "v1"
gcp.cloud_run.job.execution = "my-job-execution-abc123"
```

---

## Go å®ç°

### 1. äº‘å¹³å°è‡ªåŠ¨æ£€æµ‹

```go
package cloud

import (
    "context"
    "io"
    "net/http"
    "os"
    "strings"
    "time"

    "go.opentelemetry.io/otel/attribute"
    "go.opentelemetry.io/otel/sdk/resource"
    semconv "go.opentelemetry.io/otel/semconv/v1.24.0"
)

// CloudProvider äº‘æœåŠ¡æä¾›å•†
type CloudProvider string

const (
    AWS   CloudProvider = "aws"
    Azure CloudProvider = "azure"
    GCP   CloudProvider = "gcp"
    Unknown CloudProvider = "unknown"
)

// DetectCloudProvider è‡ªåŠ¨æ£€æµ‹äº‘æœåŠ¡æä¾›å•†
func DetectCloudProvider() CloudProvider {
    // æ£€æµ‹é¡ºåº: ç¯å¢ƒå˜é‡ -> å…ƒæ•°æ®æœåŠ¡

    // 1. æ£€æŸ¥ç¯å¢ƒå˜é‡
    if provider := os.Getenv("CLOUD_PROVIDER"); provider != "" {
        return CloudProvider(strings.ToLower(provider))
    }

    // 2. AWS æ£€æµ‹
    if isAWS() {
        return AWS
    }

    // 3. Azure æ£€æµ‹
    if isAzure() {
        return Azure
    }

    // 4. GCP æ£€æµ‹
    if isGCP() {
        return GCP
    }

    return Unknown
}

// isAWS æ£€æµ‹æ˜¯å¦åœ¨ AWS ç¯å¢ƒ
func isAWS() bool {
    // AWS ç¯å¢ƒå˜é‡
    if os.Getenv("AWS_REGION") != "" || os.Getenv("AWS_DEFAULT_REGION") != "" {
        return true
    }

    // AWS EC2 å…ƒæ•°æ®æœåŠ¡
    return checkMetadataService("http://169.254.169.254/latest/meta-data/")
}

// isAzure æ£€æµ‹æ˜¯å¦åœ¨ Azure ç¯å¢ƒ
func isAzure() bool {
    // Azure ç¯å¢ƒå˜é‡
    if os.Getenv("AZURE_SUBSCRIPTION_ID") != "" {
        return true
    }

    // Azure Instance Metadata Service
    return checkMetadataService("http://169.254.169.254/metadata/instance?api-version=2021-02-01")
}

// isGCP æ£€æµ‹æ˜¯å¦åœ¨ GCP ç¯å¢ƒ
func isGCP() bool {
    // GCP ç¯å¢ƒå˜é‡
    if os.Getenv("GCP_PROJECT") != "" || os.Getenv("GOOGLE_CLOUD_PROJECT") != "" {
        return true
    }

    // GCP Metadata Service
    return checkMetadataService("http://metadata.google.internal/computeMetadata/v1/")
}

// checkMetadataService æ£€æŸ¥å…ƒæ•°æ®æœåŠ¡æ˜¯å¦å¯è®¿é—®
func checkMetadataService(url string) bool {
    client := &http.Client{
        Timeout: 100 * time.Millisecond, // å¿«é€Ÿè¶…æ—¶
    }

    req, err := http.NewRequest("GET", url, nil)
    if err != nil {
        return false
    }

    // GCP éœ€è¦ç‰¹æ®Šçš„ header
    if strings.Contains(url, "metadata.google.internal") {
        req.Header.Set("Metadata-Flavor", "Google")
    }

    resp, err := client.Do(req)
    if err != nil {
        return false
    }
    defer resp.Body.Close()

    return resp.StatusCode == 200
}

// NewCloudResource åˆ›å»ºäº‘èµ„æº
func NewCloudResource(ctx context.Context) (*resource.Resource, error) {
    provider := DetectCloudProvider()

    switch provider {
    case AWS:
        return NewAWSResource(ctx)
    case Azure:
        return NewAzureResource(ctx)
    case GCP:
        return NewGCPResource(ctx)
    default:
        return resource.New(ctx)
    }
}
```

### 2. AWS èµ„æºæ£€æµ‹

```go
package aws

import (
    "context"
    "encoding/json"
    "io"
    "net/http"
    "os"
    "time"

    "go.opentelemetry.io/otel/sdk/resource"
    semconv "go.opentelemetry.io/otel/semconv/v1.24.0"
    "go.opentelemetry.io/otel/attribute"
)

const (
    ec2MetadataURL = "http://169.254.169.254/latest/meta-data/"
    ec2DynamicURL  = "http://169.254.169.254/latest/dynamic/"
)

// EC2Metadata EC2 å…ƒæ•°æ®
type EC2Metadata struct {
    InstanceID       string
    InstanceType     string
    Region           string
    AvailabilityZone string
    AccountID        string
    ImageID          string
}

// NewAWSResource åˆ›å»º AWS èµ„æº
func NewAWSResource(ctx context.Context) (*resource.Resource, error) {
    attrs := []attribute.KeyValue{
        semconv.CloudProviderAWS,
    }

    // æ£€æµ‹å¹³å°ç±»å‹
    platform := detectAWSPlatform()
    if platform != "" {
        attrs = append(attrs, semconv.CloudPlatform(platform))
    }

    // è·å– EC2 å…ƒæ•°æ®
    metadata, err := getEC2Metadata()
    if err == nil {
        if metadata.Region != "" {
            attrs = append(attrs, semconv.CloudRegion(metadata.Region))
        }
        if metadata.AvailabilityZone != "" {
            attrs = append(attrs, semconv.CloudAvailabilityZone(metadata.AvailabilityZone))
        }
        if metadata.AccountID != "" {
            attrs = append(attrs, semconv.CloudAccountID(metadata.AccountID))
        }
        if metadata.InstanceID != "" {
            attrs = append(attrs, semconv.CloudResourceID(metadata.InstanceID))
            attrs = append(attrs, semconv.HostID(metadata.InstanceID))
        }
        if metadata.InstanceType != "" {
            attrs = append(attrs, semconv.HostType(metadata.InstanceType))
        }
        if metadata.ImageID != "" {
            attrs = append(attrs, semconv.HostImageID(metadata.ImageID))
        }
    }

    // ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§æ›´é«˜
    if region := os.Getenv("AWS_REGION"); region != "" {
        attrs = append(attrs, semconv.CloudRegion(region))
    }

    return resource.New(ctx, resource.WithAttributes(attrs...))
}

// detectAWSPlatform æ£€æµ‹ AWS å¹³å°ç±»å‹
func detectAWSPlatform() string {
    // ECS æ£€æµ‹
    if os.Getenv("ECS_CONTAINER_METADATA_URI") != "" ||
       os.Getenv("ECS_CONTAINER_METADATA_URI_V4") != "" {
        return "aws_ecs"
    }

    // Lambda æ£€æµ‹
    if os.Getenv("AWS_LAMBDA_FUNCTION_NAME") != "" {
        return "aws_lambda"
    }

    // EKS æ£€æµ‹ (é€šè¿‡ Kubernetes ç¯å¢ƒåˆ¤æ–­)
    if os.Getenv("KUBERNETES_SERVICE_HOST") != "" {
        return "aws_eks"
    }

    // é»˜è®¤ EC2
    return "aws_ec2"
}

// getEC2Metadata è·å– EC2 å…ƒæ•°æ®
func getEC2Metadata() (*EC2Metadata, error) {
    client := &http.Client{
        Timeout: 1 * time.Second,
    }

    metadata := &EC2Metadata{}

    // è·å–å®ä¾‹ ID
    if data, err := getMetadata(client, ec2MetadataURL+"instance-id"); err == nil {
        metadata.InstanceID = string(data)
    }

    // è·å–å®ä¾‹ç±»å‹
    if data, err := getMetadata(client, ec2MetadataURL+"instance-type"); err == nil {
        metadata.InstanceType = string(data)
    }

    // è·å–åŒºåŸŸå’Œå¯ç”¨åŒº
    if data, err := getMetadata(client, ec2MetadataURL+"placement/availability-zone"); err == nil {
        metadata.AvailabilityZone = string(data)
        // åŒºåŸŸæ˜¯å¯ç”¨åŒºå»æ‰æœ€åä¸€ä¸ªå­—ç¬¦
        if len(metadata.AvailabilityZone) > 0 {
            metadata.Region = metadata.AvailabilityZone[:len(metadata.AvailabilityZone)-1]
        }
    }

    // è·å–è´¦æˆ· ID (ä» instance identity document)
    if data, err := getMetadata(client, ec2DynamicURL+"instance-identity/document"); err == nil {
        var doc struct {
            AccountID string `json:"accountId"`
            ImageID   string `json:"imageId"`
        }
        if json.Unmarshal(data, &doc) == nil {
            metadata.AccountID = doc.AccountID
            metadata.ImageID = doc.ImageID
        }
    }

    return metadata, nil
}

// getMetadata è·å–å…ƒæ•°æ®
func getMetadata(client *http.Client, url string) ([]byte, error) {
    resp, err := client.Get(url)
    if err != nil {
        return nil, err
    }
    defer resp.Body.Close()

    return io.ReadAll(resp.Body)
}
```

### 3. Azure èµ„æºæ£€æµ‹

```go
package azure

import (
    "context"
    "encoding/json"
    "io"
    "net/http"
    "os"
    "time"

    "go.opentelemetry.io/otel/sdk/resource"
    semconv "go.opentelemetry.io/otel/semconv/v1.24.0"
    "go.opentelemetry.io/otel/attribute"
)

const (
    azureMetadataURL = "http://169.254.169.254/metadata/instance?api-version=2021-02-01"
)

// AzureMetadata Azure å…ƒæ•°æ®
type AzureMetadata struct {
    Compute struct {
        AzureEnvironment  string `json:"azEnvironment"`
        Location          string `json:"location"`
        Name              string `json:"name"`
        ResourceGroupName string `json:"resourceGroupName"`
        SubscriptionID    string `json:"subscriptionId"`
        VMID              string `json:"vmId"`
        VMSize            string `json:"vmSize"`
        ResourceID        string `json:"resourceId"`
    } `json:"compute"`
}

// NewAzureResource åˆ›å»º Azure èµ„æº
func NewAzureResource(ctx context.Context) (*resource.Resource, error) {
    attrs := []attribute.KeyValue{
        semconv.CloudProviderAzure,
    }

    // æ£€æµ‹å¹³å°ç±»å‹
    platform := detectAzurePlatform()
    if platform != "" {
        attrs = append(attrs, semconv.CloudPlatform(platform))
    }

    // è·å– Azure å…ƒæ•°æ®
    metadata, err := getAzureMetadata()
    if err == nil {
        if metadata.Compute.Location != "" {
            attrs = append(attrs, semconv.CloudRegion(metadata.Compute.Location))
        }
        if metadata.Compute.SubscriptionID != "" {
            attrs = append(attrs, semconv.CloudAccountID(metadata.Compute.SubscriptionID))
        }
        if metadata.Compute.ResourceID != "" {
            attrs = append(attrs, semconv.CloudResourceID(metadata.Compute.ResourceID))
        }
        if metadata.Compute.Name != "" {
            attrs = append(attrs, semconv.HostID(metadata.Compute.Name))
        }
        if metadata.Compute.VMSize != "" {
            attrs = append(attrs, semconv.HostType(metadata.Compute.VMSize))
        }
        if metadata.Compute.ResourceGroupName != "" {
            attrs = append(attrs, attribute.String("azure.resourcegroup.name", metadata.Compute.ResourceGroupName))
        }
    }

    // ç¯å¢ƒå˜é‡ä¼˜å…ˆ
    if subID := os.Getenv("AZURE_SUBSCRIPTION_ID"); subID != "" {
        attrs = append(attrs, semconv.CloudAccountID(subID))
    }

    return resource.New(ctx, resource.WithAttributes(attrs...))
}

// detectAzurePlatform æ£€æµ‹ Azure å¹³å°ç±»å‹
func detectAzurePlatform() string {
    // AKS æ£€æµ‹
    if os.Getenv("KUBERNETES_SERVICE_HOST") != "" {
        return "azure_aks"
    }

    // Azure Functions æ£€æµ‹
    if os.Getenv("FUNCTIONS_WORKER_RUNTIME") != "" {
        return "azure_functions"
    }

    // Container Instances æ£€æµ‹
    if os.Getenv("CONTAINER_APP_NAME") != "" {
        return "azure_container_apps"
    }

    // é»˜è®¤ VM
    return "azure_vm"
}

// getAzureMetadata è·å– Azure å…ƒæ•°æ®
func getAzureMetadata() (*AzureMetadata, error) {
    client := &http.Client{
        Timeout: 1 * time.Second,
    }

    req, err := http.NewRequest("GET", azureMetadataURL, nil)
    if err != nil {
        return nil, err
    }

    req.Header.Set("Metadata", "true")

    resp, err := client.Do(req)
    if err != nil {
        return nil, err
    }
    defer resp.Body.Close()

    data, err := io.ReadAll(resp.Body)
    if err != nil {
        return nil, err
    }

    var metadata AzureMetadata
    if err := json.Unmarshal(data, &metadata); err != nil {
        return nil, err
    }

    return &metadata, nil
}
```

### 4. GCP èµ„æºæ£€æµ‹

```go
package gcp

import (
    "context"
    "io"
    "net/http"
    "os"
    "strings"
    "time"

    "go.opentelemetry.io/otel/sdk/resource"
    semconv "go.opentelemetry.io/otel/semconv/v1.24.0"
    "go.opentelemetry.io/otel/attribute"
)

const (
    gcpMetadataURL = "http://metadata.google.internal/computeMetadata/v1/"
)

// NewGCPResource åˆ›å»º GCP èµ„æº
func NewGCPResource(ctx context.Context) (*resource.Resource, error) {
    attrs := []attribute.KeyValue{
        semconv.CloudProviderGCP,
    }

    // æ£€æµ‹å¹³å°ç±»å‹
    platform := detectGCPPlatform()
    if platform != "" {
        attrs = append(attrs, semconv.CloudPlatform(platform))
    }

    // è·å– GCP å…ƒæ•°æ®
    client := &http.Client{Timeout: 1 * time.Second}

    // é¡¹ç›® ID
    if projectID, err := getGCPMetadata(client, "project/project-id"); err == nil {
        attrs = append(attrs, semconv.CloudAccountID(projectID))
    }

    // åŒºåŸŸ
    if zone, err := getGCPMetadata(client, "instance/zone"); err == nil {
        // zone æ ¼å¼: projects/PROJECT_NUM/zones/ZONE
        parts := strings.Split(zone, "/")
        if len(parts) > 0 {
            zoneName := parts[len(parts)-1]
            attrs = append(attrs, semconv.CloudAvailabilityZone(zoneName))
            // åŒºåŸŸæ˜¯ zone å»æ‰æœ€åçš„å­—æ¯
            if idx := strings.LastIndex(zoneName, "-"); idx > 0 {
                region := zoneName[:idx]
                attrs = append(attrs, semconv.CloudRegion(region))
            }
        }
    }

    // å®ä¾‹ ID
    if instanceID, err := getGCPMetadata(client, "instance/id"); err == nil {
        attrs = append(attrs, semconv.CloudResourceID(instanceID))
        attrs = append(attrs, semconv.HostID(instanceID))
    }

    // å®ä¾‹åç§°
    if instanceName, err := getGCPMetadata(client, "instance/name"); err == nil {
        attrs = append(attrs, semconv.HostName(instanceName))
    }

    // æœºå™¨ç±»å‹
    if machineType, err := getGCPMetadata(client, "instance/machine-type"); err == nil {
        // machine-type æ ¼å¼: projects/PROJECT_NUM/machineTypes/TYPE
        parts := strings.Split(machineType, "/")
        if len(parts) > 0 {
            attrs = append(attrs, semconv.HostType(parts[len(parts)-1]))
        }
    }

    // ç¯å¢ƒå˜é‡ä¼˜å…ˆ
    if projectID := os.Getenv("GOOGLE_CLOUD_PROJECT"); projectID != "" {
        attrs = append(attrs, semconv.CloudAccountID(projectID))
    }

    return resource.New(ctx, resource.WithAttributes(attrs...))
}

// detectGCPPlatform æ£€æµ‹ GCP å¹³å°ç±»å‹
func detectGCPPlatform() string {
    // GKE æ£€æµ‹
    if os.Getenv("KUBERNETES_SERVICE_HOST") != "" {
        return "gcp_kubernetes_engine"
    }

    // Cloud Run æ£€æµ‹
    if os.Getenv("K_SERVICE") != "" {
        return "gcp_cloud_run"
    }

    // Cloud Functions æ£€æµ‹
    if os.Getenv("FUNCTION_TARGET") != "" {
        return "gcp_cloud_functions"
    }

    // App Engine æ£€æµ‹
    if os.Getenv("GAE_APPLICATION") != "" {
        return "gcp_app_engine"
    }

    // é»˜è®¤ Compute Engine
    return "gcp_compute_engine"
}

// getGCPMetadata è·å– GCP å…ƒæ•°æ®
func getGCPMetadata(client *http.Client, path string) (string, error) {
    req, err := http.NewRequest("GET", gcpMetadataURL+path, nil)
    if err != nil {
        return "", err
    }

    req.Header.Set("Metadata-Flavor", "Google")

    resp, err := client.Do(req)
    if err != nil {
        return "", err
    }
    defer resp.Body.Close()

    data, err := io.ReadAll(resp.Body)
    if err != nil {
        return "", err
    }

    return string(data), nil
}
```

---

## æœ€ä½³å®è·µ

### 1. äº‘å¹³å°æ£€æµ‹ä¼˜å…ˆçº§

```text
æ¨èçš„æ£€æµ‹ä¼˜å…ˆçº§:

1. æ˜¾å¼é…ç½® (ç¯å¢ƒå˜é‡)
   CLOUD_PROVIDER=aws

2. å…ƒæ•°æ®æœåŠ¡
   - AWS: http://169.254.169.254/
   - Azure: http://169.254.169.254/metadata/
   - GCP: http://metadata.google.internal/

3. ç‰¹å®šç¯å¢ƒå˜é‡
   - AWS: AWS_REGION, AWS_DEFAULT_REGION
   - Azure: AZURE_SUBSCRIPTION_ID
   - GCP: GOOGLE_CLOUD_PROJECT

4. é»˜è®¤å€¼
   provider = "unknown"
```

### 2. è¶…æ—¶è®¾ç½®

```go
// å…ƒæ•°æ®æœåŠ¡è¯·æ±‚åº”è¯¥å¿«é€Ÿè¶…æ—¶
client := &http.Client{
    Timeout: 100 * time.Millisecond, // æ£€æµ‹æ—¶ä½¿ç”¨æçŸ­è¶…æ—¶
}

// è·å–å…ƒæ•°æ®æ—¶å¯ä»¥ç¨é•¿
client := &http.Client{
    Timeout: 1 * time.Second, // å®é™…è·å–æ—¶ä½¿ç”¨1ç§’è¶…æ—¶
}
```

### 3. ç¼“å­˜å…ƒæ•°æ®

```go
var (
    cachedMetadata *CloudMetadata
    metadataOnce   sync.Once
)

func GetCloudMetadata() *CloudMetadata {
    metadataOnce.Do(func() {
        cachedMetadata = fetchCloudMetadata()
    })
    return cachedMetadata
}
```

---

## å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£

- [OpenTelemetry Semantic Conventions - Cloud](https://opentelemetry.io/docs/specs/semconv/resource/cloud/)
- [AWS EC2 Instance Metadata](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html)
- [Azure Instance Metadata Service](https://docs.microsoft.com/en-us/azure/virtual-machines/linux/instance-metadata-service)
- [GCP Instance Metadata](https://cloud.google.com/compute/docs/metadata/overview)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ9æ—¥  
**ç»´æŠ¤è€…**: OTLP æ ‡å‡†åŒ–é¡¹ç›®ç»„

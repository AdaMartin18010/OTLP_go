# éƒ¨ç½²ç¯å¢ƒèµ„æºå±æ€§ (Deployment Environment Attributes)

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
> **OpenTelemetry ç‰ˆæœ¬**: v1.32.0  
> **è¯­ä¹‰çº¦å®šç‰ˆæœ¬**: v1.28.0  
> **æœ€åæ›´æ–°**: 2025å¹´10æœˆ9æ—¥

---

## ğŸ“‹ ç›®å½•

- [éƒ¨ç½²ç¯å¢ƒèµ„æºå±æ€§ (Deployment Environment Attributes)](#éƒ¨ç½²ç¯å¢ƒèµ„æºå±æ€§-deployment-environment-attributes)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [æ¦‚è¿°](#æ¦‚è¿°)
    - [éƒ¨ç½²ç¯å¢ƒçš„å®šä¹‰](#éƒ¨ç½²ç¯å¢ƒçš„å®šä¹‰)
    - [ä¸ºä»€ä¹ˆéœ€è¦éƒ¨ç½²ç¯å¢ƒå±æ€§?](#ä¸ºä»€ä¹ˆéœ€è¦éƒ¨ç½²ç¯å¢ƒå±æ€§)
  - [æ ¸å¿ƒå±æ€§](#æ ¸å¿ƒå±æ€§)
    - [å®Œæ•´å±æ€§åˆ—è¡¨](#å®Œæ•´å±æ€§åˆ—è¡¨)
  - [ç¯å¢ƒç±»å‹](#ç¯å¢ƒç±»å‹)
    - [1. æ ‡å‡†ç¯å¢ƒç±»å‹](#1-æ ‡å‡†ç¯å¢ƒç±»å‹)
    - [2. ç¯å¢ƒå‘½åè§„èŒƒ](#2-ç¯å¢ƒå‘½åè§„èŒƒ)
    - [3. ç¯å¢ƒå±‚çº§](#3-ç¯å¢ƒå±‚çº§)
  - [åŒºåŸŸä¸å¯ç”¨åŒº](#åŒºåŸŸä¸å¯ç”¨åŒº)
    - [1. åœ°ç†åŒºåŸŸ](#1-åœ°ç†åŒºåŸŸ)
    - [2. å¯ç”¨åŒº](#2-å¯ç”¨åŒº)
  - [Go å®ç°](#go-å®ç°)
    - [1. åŸºç¡€å®ç°](#1-åŸºç¡€å®ç°)
    - [2. ç¯å¢ƒé…ç½®ç®¡ç†](#2-ç¯å¢ƒé…ç½®ç®¡ç†)
    - [3. ç¯å¢ƒç‰¹å®šé…ç½®](#3-ç¯å¢ƒç‰¹å®šé…ç½®)
    - [4. Kubernetes ç¯å¢ƒæ£€æµ‹](#4-kubernetes-ç¯å¢ƒæ£€æµ‹)
  - [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
    - [1. ç¯å¢ƒå‘½åæ ‡å‡†åŒ–](#1-ç¯å¢ƒå‘½åæ ‡å‡†åŒ–)
    - [2. ç¯å¢ƒä¿æŠ¤æœºåˆ¶](#2-ç¯å¢ƒä¿æŠ¤æœºåˆ¶)
    - [3. ç¯å¢ƒç‰¹å®šçš„é¥æµ‹é…ç½®](#3-ç¯å¢ƒç‰¹å®šçš„é¥æµ‹é…ç½®)
    - [4. ç¯å¢ƒå˜é‡éªŒè¯](#4-ç¯å¢ƒå˜é‡éªŒè¯)
  - [å‚è€ƒèµ„æº](#å‚è€ƒèµ„æº)
    - [å®˜æ–¹æ–‡æ¡£](#å®˜æ–¹æ–‡æ¡£)
    - [ç›¸å…³å·¥å…·](#ç›¸å…³å·¥å…·)

---

## æ¦‚è¿°

### éƒ¨ç½²ç¯å¢ƒçš„å®šä¹‰

**å½¢å¼åŒ–å®šä¹‰**:

```text
DeploymentEnvironment = (Environment, Region, AvailabilityZone)

å…¶ä¸­:
- Environment: éƒ¨ç½²ç¯å¢ƒç±»å‹ (æ¨è)
- Region: åœ°ç†åŒºåŸŸ (å¯é€‰)
- AvailabilityZone: å¯ç”¨åŒº (å¯é€‰)
```

### ä¸ºä»€ä¹ˆéœ€è¦éƒ¨ç½²ç¯å¢ƒå±æ€§?

```text
1. ç¯å¢ƒéš”ç¦»
   - åŒºåˆ†ç”Ÿäº§ã€é¢„å‘å¸ƒã€å¼€å‘ç¯å¢ƒ
   - é¿å…è·¨ç¯å¢ƒæ•°æ®æ··æ·†

2. é—®é¢˜å®šä½
   - å¿«é€Ÿè¯†åˆ«é—®é¢˜ç¯å¢ƒ
   - ç¯å¢ƒç‰¹å®šçš„é—®é¢˜åˆ†æ

3. æ€§èƒ½å¯¹æ¯”
   - è·¨ç¯å¢ƒæ€§èƒ½æ¯”è¾ƒ
   - å®¹é‡è§„åˆ’ä¸ä¼˜åŒ–

4. åˆè§„ä¸å®¡è®¡
   - ç”Ÿäº§ç¯å¢ƒè®¿é—®æ§åˆ¶
   - æ•°æ®ä¿æŠ¤åˆè§„æ€§

5. ç¾éš¾æ¢å¤
   - åŒºåŸŸæ•…éšœéš”ç¦»
   - è·¨åŒºåŸŸæµé‡åˆ‡æ¢
```

---

## æ ¸å¿ƒå±æ€§

### å®Œæ•´å±æ€§åˆ—è¡¨

| å±æ€§å | ç±»å‹ | å¿…éœ€æ€§ | æè¿° | ç¤ºä¾‹ |
|-------|------|--------|------|------|
| `deployment.environment` | string | æ¨è | éƒ¨ç½²ç¯å¢ƒåç§° | `production` |
| `deployment.environment.name` | string | å¯é€‰ | ç¯å¢ƒæ˜¾ç¤ºåç§° | `Production US-East` |

**æ³¨æ„**: OpenTelemetry è¯­ä¹‰çº¦å®šä¸­ä¸»è¦ä½¿ç”¨ `deployment.environment`,å…¶ä»–åŒºåŸŸç›¸å…³å±æ€§é€šå¸¸ç”±äº‘å¹³å°ç‰¹å®šå±æ€§æä¾›ã€‚

---

## ç¯å¢ƒç±»å‹

### 1. æ ‡å‡†ç¯å¢ƒç±»å‹

```text
production (ç”Ÿäº§ç¯å¢ƒ)
  - å¯¹å¤–æä¾›æœåŠ¡çš„æ­£å¼ç¯å¢ƒ
  - æœ€é«˜ç¨³å®šæ€§å’Œå¯ç”¨æ€§è¦æ±‚
  - ä¸¥æ ¼çš„å˜æ›´æ§åˆ¶

staging (é¢„å‘å¸ƒç¯å¢ƒ)
  - ç”Ÿäº§å‰çš„æœ€åæµ‹è¯•ç¯å¢ƒ
  - é…ç½®æ¥è¿‘ç”Ÿäº§ç¯å¢ƒ
  - ç”¨äºæœ€ç»ˆéªŒè¯

development (å¼€å‘ç¯å¢ƒ)
  - å¼€å‘äººå‘˜æ—¥å¸¸å¼€å‘ç¯å¢ƒ
  - é…ç½®çµæ´»,å¯éšæ—¶é‡å¯
  - ç”¨äºåŠŸèƒ½å¼€å‘å’Œè°ƒè¯•

test (æµ‹è¯•ç¯å¢ƒ)
  - è‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒ
  - ç”¨äº CI/CD æµç¨‹
  - å¯èƒ½æœ‰å¤šä¸ªå®ä¾‹

qa (QA ç¯å¢ƒ)
  - è´¨é‡ä¿è¯å›¢é˜Ÿä½¿ç”¨
  - ç”¨äºåŠŸèƒ½å’Œå›å½’æµ‹è¯•
  - ç›¸å¯¹ç¨³å®š

demo (æ¼”ç¤ºç¯å¢ƒ)
  - äº§å“æ¼”ç¤ºå’ŒåŸ¹è®­
  - åŒ…å«ç¤ºä¾‹æ•°æ®
  - å…¬å¼€è®¿é—®
```

### 2. ç¯å¢ƒå‘½åè§„èŒƒ

```text
âœ… æ¨èå‘½å:

1. ä½¿ç”¨å°å†™
   production, staging, development

2. ä½¿ç”¨æ ‡å‡†åç§°
   production (ä¸æ˜¯ prod, live)
   staging (ä¸æ˜¯ stage, pre-prod)
   development (ä¸æ˜¯ dev, devel)

3. ç¯å¢ƒå˜ä½“å¯ä½¿ç”¨åç¼€
   production-us
   production-eu
   staging-team-alpha

âŒ é¿å…:

1. å¤§å°å†™æ··åˆ
   âœ— Production, STAGING

2. ç¼©å†™è¿‡åº¦
   âœ— prod, stg, dev

3. æ•°å­—åç¼€ (é™¤éå¿…è¦)
   âœ— production1, production2
   âœ“ ä½¿ç”¨åŒºåŸŸ: production-us, production-eu
```

### 3. ç¯å¢ƒå±‚çº§

```text
å®Œæ•´çš„ç¯å¢ƒå±‚çº§:

Local (æœ¬åœ°)
  â†“
Development (å¼€å‘)
  â†“
Test (æµ‹è¯•)
  â†“
QA (è´¨é‡ä¿è¯)
  â†“
Staging (é¢„å‘å¸ƒ)
  â†“
Production (ç”Ÿäº§)

ç®€åŒ–çš„ç¯å¢ƒå±‚çº§ (å°å‹é¡¹ç›®):

Development
  â†“
Staging
  â†“
Production
```

---

## åŒºåŸŸä¸å¯ç”¨åŒº

### 1. åœ°ç†åŒºåŸŸ

è™½ç„¶ `deployment.environment` ä¸ç›´æ¥åŒ…å«åŒºåŸŸä¿¡æ¯,ä½†å¯ä»¥é€šè¿‡äº‘å¹³å°å±æ€§æˆ–è‡ªå®šä¹‰å±æ€§è¡¨ç¤º:

```text
åŒºåŸŸå‘½åç¤ºä¾‹:

ç¾æ´²:
  us-east-1, us-west-2
  na-central-1
  sa-east-1

æ¬§æ´²:
  eu-west-1, eu-central-1
  eu-north-1

äºšå¤ª:
  ap-southeast-1, ap-northeast-1
  ap-south-1

æ··åˆ:
  - ä½¿ç”¨äº‘å‚å•†æ ‡å‡†å‘½å
  - æˆ–è‡ªå®šä¹‰: region-country-datacenter
```

### 2. å¯ç”¨åŒº

```text
å¯ç”¨åŒºå‘½å:

å•åŒºåŸŸå†…çš„å¯ç”¨åŒº:
  us-east-1a, us-east-1b, us-east-1c

æ•°æ®ä¸­å¿ƒ:
  dc1, dc2, dc3
  datacenter-alpha, datacenter-beta
```

---

## Go å®ç°

### 1. åŸºç¡€å®ç°

```go
package main

import (
    "context"
    "fmt"
    "log"
    "os"

    "go.opentelemetry.io/otel"
    "go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc"
    "go.opentelemetry.io/otel/sdk/resource"
    sdktrace "go.opentelemetry.io/otel/sdk/trace"
    semconv "go.opentelemetry.io/otel/semconv/v1.24.0"
)

func initTracerWithEnvironment() (*sdktrace.TracerProvider, error) {
    ctx := context.Background()

    // åˆ›å»ºå¯¼å‡ºå™¨
    exporter, err := otlptracegrpc.New(ctx,
        otlptracegrpc.WithInsecure(),
        otlptracegrpc.WithEndpoint("localhost:4317"),
    )
    if err != nil {
        return nil, err
    }

    // åˆ›å»ºèµ„æº,åŒ…å«éƒ¨ç½²ç¯å¢ƒ
    res, err := resource.New(ctx,
        resource.WithAttributes(
            // æœåŠ¡å±æ€§
            semconv.ServiceName("order-service"),
            semconv.ServiceVersion("1.2.3"),
            
            // éƒ¨ç½²ç¯å¢ƒ
            semconv.DeploymentEnvironment(getEnvironment()),
        ),
    )
    if err != nil {
        return nil, err
    }

    tp := sdktrace.NewTracerProvider(
        sdktrace.WithBatcher(exporter),
        sdktrace.WithResource(res),
    )

    otel.SetTracerProvider(tp)
    return tp, nil
}

// getEnvironment è·å–éƒ¨ç½²ç¯å¢ƒ
func getEnvironment() string {
    env := os.Getenv("DEPLOYMENT_ENVIRONMENT")
    if env == "" {
        env = os.Getenv("ENV")
    }
    if env == "" {
        env = "development" // é»˜è®¤å¼€å‘ç¯å¢ƒ
    }
    return env
}

func main() {
    tp, err := initTracerWithEnvironment()
    if err != nil {
        log.Fatalf("Failed to initialize tracer: %v", err)
    }
    defer tp.Shutdown(context.Background())

    fmt.Printf("Running in environment: %s\n", getEnvironment())
}
```

### 2. ç¯å¢ƒé…ç½®ç®¡ç†

```go
package config

import (
    "fmt"
    "os"
    "strings"
)

// Environment ç¯å¢ƒç±»å‹
type Environment string

const (
    EnvProduction  Environment = "production"
    EnvStaging     Environment = "staging"
    EnvDevelopment Environment = "development"
    EnvTest        Environment = "test"
    EnvQA          Environment = "qa"
    EnvDemo        Environment = "demo"
)

// EnvironmentConfig ç¯å¢ƒé…ç½®
type EnvironmentConfig struct {
    Name        Environment
    DisplayName string
    Region      string
    Zone        string
}

// NewEnvironmentConfig åˆ›å»ºç¯å¢ƒé…ç½®
func NewEnvironmentConfig() *EnvironmentConfig {
    envName := getEnvironmentName()
    
    return &EnvironmentConfig{
        Name:        envName,
        DisplayName: getDisplayName(envName),
        Region:      os.Getenv("REGION"),
        Zone:        os.Getenv("AVAILABILITY_ZONE"),
    }
}

// getEnvironmentName è·å–ç¯å¢ƒåç§°
func getEnvironmentName() Environment {
    // ä¼˜å…ˆçº§1: DEPLOYMENT_ENVIRONMENT
    if env := os.Getenv("DEPLOYMENT_ENVIRONMENT"); env != "" {
        return normalizeEnvironment(env)
    }

    // ä¼˜å…ˆçº§2: ENV
    if env := os.Getenv("ENV"); env != "" {
        return normalizeEnvironment(env)
    }

    // ä¼˜å…ˆçº§3: ä» Kubernetes å‘½åç©ºé—´æ¨æ–­
    if ns := os.Getenv("K8S_NAMESPACE"); ns != "" {
        if strings.Contains(ns, "prod") {
            return EnvProduction
        }
        if strings.Contains(ns, "staging") {
            return EnvStaging
        }
    }

    // é»˜è®¤: development
    return EnvDevelopment
}

// normalizeEnvironment æ ‡å‡†åŒ–ç¯å¢ƒåç§°
func normalizeEnvironment(env string) Environment {
    env = strings.ToLower(strings.TrimSpace(env))

    switch env {
    case "production", "prod", "live":
        return EnvProduction
    case "staging", "stage", "pre-prod", "preprod":
        return EnvStaging
    case "development", "dev", "devel":
        return EnvDevelopment
    case "test", "testing":
        return EnvTest
    case "qa", "quality":
        return EnvQA
    case "demo", "demonstration":
        return EnvDemo
    default:
        return Environment(env)
    }
}

// getDisplayName è·å–æ˜¾ç¤ºåç§°
func getDisplayName(env Environment) string {
    region := os.Getenv("REGION")
    if region != "" {
        return fmt.Sprintf("%s (%s)", strings.Title(string(env)), region)
    }
    return strings.Title(string(env))
}

// IsProduction æ˜¯å¦ç”Ÿäº§ç¯å¢ƒ
func (ec *EnvironmentConfig) IsProduction() bool {
    return ec.Name == EnvProduction
}

// IsStaging æ˜¯å¦é¢„å‘å¸ƒç¯å¢ƒ
func (ec *EnvironmentConfig) IsStaging() bool {
    return ec.Name == EnvStaging
}

// IsDevelopment æ˜¯å¦å¼€å‘ç¯å¢ƒ
func (ec *EnvironmentConfig) IsDevelopment() bool {
    return ec.Name == EnvDevelopment
}

// String å­—ç¬¦ä¸²è¡¨ç¤º
func (ec *EnvironmentConfig) String() string {
    if ec.Region != "" && ec.Zone != "" {
        return fmt.Sprintf("%s (%s, %s)", ec.Name, ec.Region, ec.Zone)
    }
    if ec.Region != "" {
        return fmt.Sprintf("%s (%s)", ec.Name, ec.Region)
    }
    return string(ec.Name)
}
```

### 3. ç¯å¢ƒç‰¹å®šé…ç½®

```go
package config

import (
    "time"
)

// Config åº”ç”¨é…ç½®
type Config struct {
    Environment *EnvironmentConfig
    
    // ç¯å¢ƒç‰¹å®šé…ç½®
    LogLevel          string
    EnableDebug       bool
    TraceSampleRate   float64
    MetricInterval    time.Duration
    EnableProfiling   bool
}

// NewConfig åˆ›å»ºé…ç½®
func NewConfig() *Config {
    env := NewEnvironmentConfig()
    
    cfg := &Config{
        Environment: env,
    }

    // æ ¹æ®ç¯å¢ƒè®¾ç½®é»˜è®¤å€¼
    switch env.Name {
    case EnvProduction:
        cfg.LogLevel = "info"
        cfg.EnableDebug = false
        cfg.TraceSampleRate = 0.01 // 1% é‡‡æ ·
        cfg.MetricInterval = 60 * time.Second
        cfg.EnableProfiling = false

    case EnvStaging:
        cfg.LogLevel = "debug"
        cfg.EnableDebug = true
        cfg.TraceSampleRate = 0.1 // 10% é‡‡æ ·
        cfg.MetricInterval = 30 * time.Second
        cfg.EnableProfiling = true

    case EnvDevelopment:
        cfg.LogLevel = "debug"
        cfg.EnableDebug = true
        cfg.TraceSampleRate = 1.0 // 100% é‡‡æ ·
        cfg.MetricInterval = 10 * time.Second
        cfg.EnableProfiling = true

    default:
        cfg.LogLevel = "info"
        cfg.EnableDebug = false
        cfg.TraceSampleRate = 0.1
        cfg.MetricInterval = 30 * time.Second
        cfg.EnableProfiling = false
    }

    return cfg
}

// ä½¿ç”¨ç¤ºä¾‹
func Example() {
    cfg := NewConfig()
    
    fmt.Printf("Environment: %s\n", cfg.Environment)
    fmt.Printf("Log Level: %s\n", cfg.LogLevel)
    fmt.Printf("Trace Sample Rate: %.2f%%\n", cfg.TraceSampleRate*100)
    
    if cfg.Environment.IsProduction() {
        fmt.Println("âš ï¸  Running in PRODUCTION")
    }
}
```

### 4. Kubernetes ç¯å¢ƒæ£€æµ‹

```go
package k8s

import (
    "context"
    "os"
    "strings"

    "go.opentelemetry.io/otel/attribute"
    "go.opentelemetry.io/otel/sdk/resource"
    semconv "go.opentelemetry.io/otel/semconv/v1.24.0"
)

// NewK8sEnvironmentResource åˆ›å»º Kubernetes ç¯å¢ƒèµ„æº
func NewK8sEnvironmentResource(ctx context.Context) (*resource.Resource, error) {
    attrs := []attribute.KeyValue{
        // éƒ¨ç½²ç¯å¢ƒ
        semconv.DeploymentEnvironment(detectK8sEnvironment()),
    }

    // æ·»åŠ  Kubernetes ç‰¹å®šå±æ€§
    if namespace := os.Getenv("K8S_NAMESPACE"); namespace != "" {
        attrs = append(attrs, 
            attribute.String("k8s.namespace.name", namespace))
    }

    if cluster := os.Getenv("K8S_CLUSTER_NAME"); cluster != "" {
        attrs = append(attrs,
            attribute.String("k8s.cluster.name", cluster))
    }

    return resource.New(ctx,
        resource.WithAttributes(attrs...),
        resource.WithFromEnv(),
        resource.WithContainer(),
    )
}

// detectK8sEnvironment ä» Kubernetes ç¯å¢ƒæ£€æµ‹éƒ¨ç½²ç¯å¢ƒ
func detectK8sEnvironment() string {
    // ä»å‘½åç©ºé—´æ£€æµ‹
    namespace := os.Getenv("K8S_NAMESPACE")
    namespace = strings.ToLower(namespace)

    if strings.Contains(namespace, "prod") {
        return "production"
    }
    if strings.Contains(namespace, "staging") || strings.Contains(namespace, "stage") {
        return "staging"
    }
    if strings.Contains(namespace, "dev") {
        return "development"
    }
    if strings.Contains(namespace, "test") {
        return "test"
    }

    // ä»æ ‡ç­¾æ£€æµ‹
    if env := os.Getenv("DEPLOYMENT_ENVIRONMENT"); env != "" {
        return env
    }

    return "unknown"
}

// Kubernetes Deployment ç¤ºä¾‹
/*
apiVersion: apps/v1
kind: Deployment
metadata:
  name: order-service
  namespace: production
spec:
  template:
    metadata:
      labels:
        app: order-service
        environment: production
    spec:
      containers:
      - name: order-service
        image: order-service:1.2.3
        env:
        # éƒ¨ç½²ç¯å¢ƒ
        - name: DEPLOYMENT_ENVIRONMENT
          value: "production"
        
        # Kubernetes ä¿¡æ¯
        - name: K8S_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        
        - name: K8S_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        
        - name: K8S_CLUSTER_NAME
          value: "production-us-east"
        
        # åŒºåŸŸä¿¡æ¯
        - name: REGION
          value: "us-east-1"
        
        - name: AVAILABILITY_ZONE
          value: "us-east-1a"
*/
```

---

## æœ€ä½³å®è·µ

### 1. ç¯å¢ƒå‘½åæ ‡å‡†åŒ–

```go
package standards

// æ ‡å‡†ç¯å¢ƒå¸¸é‡
const (
    // æ¨èä½¿ç”¨å®Œæ•´åç§°
    Production  = "production"  // âœ“
    Staging     = "staging"     // âœ“
    Development = "development" // âœ“
    
    // é¿å…ä½¿ç”¨ç¼©å†™
    // Prod = "prod"  // âœ—
    // Dev  = "dev"   // âœ—
)

// ValidEnvironments æœ‰æ•ˆç¯å¢ƒåˆ—è¡¨
var ValidEnvironments = map[string]bool{
    "production":  true,
    "staging":     true,
    "development": true,
    "test":        true,
    "qa":          true,
    "demo":        true,
}

// IsValidEnvironment éªŒè¯ç¯å¢ƒåç§°
func IsValidEnvironment(env string) bool {
    return ValidEnvironments[strings.ToLower(env)]
}

// NormalizeEnvironment æ ‡å‡†åŒ–ç¯å¢ƒåç§°
func NormalizeEnvironment(env string) (string, error) {
    env = strings.ToLower(strings.TrimSpace(env))
    
    // æ˜ å°„å¸¸è§å˜ä½“
    variants := map[string]string{
        "prod":    "production",
        "live":    "production",
        "stage":   "staging",
        "preprod": "staging",
        "dev":     "development",
        "devel":   "development",
    }
    
    if normalized, ok := variants[env]; ok {
        return normalized, nil
    }
    
    if IsValidEnvironment(env) {
        return env, nil
    }
    
    return "", fmt.Errorf("invalid environment: %s", env)
}
```

### 2. ç¯å¢ƒä¿æŠ¤æœºåˆ¶

```go
package protection

import (
    "fmt"
    "os"
)

// RequireEnvironment è¦æ±‚ç‰¹å®šç¯å¢ƒ
func RequireEnvironment(required string) error {
    current := os.Getenv("DEPLOYMENT_ENVIRONMENT")
    if current != required {
        return fmt.Errorf("operation requires %s environment, but running in %s", 
            required, current)
    }
    return nil
}

// PreventProduction é˜²æ­¢åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œ
func PreventProduction() error {
    env := os.Getenv("DEPLOYMENT_ENVIRONMENT")
    if env == "production" {
        return fmt.Errorf("operation not allowed in production environment")
    }
    return nil
}

// ConfirmProduction ç”Ÿäº§ç¯å¢ƒç¡®è®¤
func ConfirmProduction(action string) error {
    env := os.Getenv("DEPLOYMENT_ENVIRONMENT")
    if env != "production" {
        return nil // éç”Ÿäº§ç¯å¢ƒç›´æ¥é€šè¿‡
    }

    fmt.Printf("âš ï¸  WARNING: About to perform '%s' in PRODUCTION\n", action)
    fmt.Print("Type 'yes' to confirm: ")
    
    var confirm string
    fmt.Scanln(&confirm)
    
    if confirm != "yes" {
        return fmt.Errorf("operation cancelled")
    }
    
    return nil
}

// ä½¿ç”¨ç¤ºä¾‹
func DangerousOperation() error {
    // é˜²æ­¢åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œ
    if err := PreventProduction(); err != nil {
        return err
    }
    
    // æ‰§è¡Œæ“ä½œ
    fmt.Println("Performing dangerous operation...")
    return nil
}

func ProductionDeployment() error {
    // éœ€è¦ç¡®è®¤
    if err := ConfirmProduction("deployment"); err != nil {
        return err
    }
    
    // æ‰§è¡Œéƒ¨ç½²
    fmt.Println("Deploying to production...")
    return nil
}
```

### 3. ç¯å¢ƒç‰¹å®šçš„é¥æµ‹é…ç½®

```go
package telemetry

import (
    "context"
    "time"

    "go.opentelemetry.io/otel/sdk/trace"
)

// NewEnvironmentAwareSampler åˆ›å»ºç¯å¢ƒæ„ŸçŸ¥é‡‡æ ·å™¨
func NewEnvironmentAwareSampler(env string) trace.Sampler {
    switch env {
    case "production":
        // ç”Ÿäº§ç¯å¢ƒ: ä½é‡‡æ ·ç‡
        return trace.TraceIDRatioBased(0.01) // 1%

    case "staging":
        // é¢„å‘å¸ƒç¯å¢ƒ: ä¸­ç­‰é‡‡æ ·ç‡
        return trace.TraceIDRatioBased(0.1) // 10%

    case "development", "test":
        // å¼€å‘/æµ‹è¯•ç¯å¢ƒ: å…¨é‡‡æ ·
        return trace.AlwaysSample()

    default:
        // é»˜è®¤: ä¸­ç­‰é‡‡æ ·ç‡
        return trace.TraceIDRatioBased(0.1)
    }
}

// NewEnvironmentAwareExporter åˆ›å»ºç¯å¢ƒæ„ŸçŸ¥å¯¼å‡ºå™¨
func NewEnvironmentAwareExporter(ctx context.Context, env string) (trace.SpanExporter, error) {
    switch env {
    case "production":
        // ç”Ÿäº§ç¯å¢ƒ: ä½¿ç”¨ç”Ÿäº§ç«¯ç‚¹
        return otlptracegrpc.New(ctx,
            otlptracegrpc.WithEndpoint("otel-collector.prod.svc:4317"),
            otlptracegrpc.WithTLSCredentials(credentials.NewClientTLSFromCert(nil, "")),
        )

    case "staging":
        // é¢„å‘å¸ƒç¯å¢ƒ: ä½¿ç”¨é¢„å‘å¸ƒç«¯ç‚¹
        return otlptracegrpc.New(ctx,
            otlptracegrpc.WithEndpoint("otel-collector.staging.svc:4317"),
            otlptracegrpc.WithInsecure(),
        )

    default:
        // å¼€å‘ç¯å¢ƒ: ä½¿ç”¨æœ¬åœ°ç«¯ç‚¹æˆ–æ§åˆ¶å°
        return stdouttrace.New()
    }
}

// BatchConfig æ‰¹å¤„ç†é…ç½®
type BatchConfig struct {
    MaxQueueSize       int
    MaxExportBatchSize int
    BatchTimeout       time.Duration
    ExportTimeout      time.Duration
}

// NewEnvironmentAwareBatchConfig åˆ›å»ºç¯å¢ƒæ„ŸçŸ¥æ‰¹å¤„ç†é…ç½®
func NewEnvironmentAwareBatchConfig(env string) BatchConfig {
    switch env {
    case "production":
        return BatchConfig{
            MaxQueueSize:       2048,
            MaxExportBatchSize: 512,
            BatchTimeout:       5 * time.Second,
            ExportTimeout:      30 * time.Second,
        }

    case "staging":
        return BatchConfig{
            MaxQueueSize:       1024,
            MaxExportBatchSize: 256,
            BatchTimeout:       3 * time.Second,
            ExportTimeout:      10 * time.Second,
        }

    default: // development, test
        return BatchConfig{
            MaxQueueSize:       256,
            MaxExportBatchSize: 64,
            BatchTimeout:       1 * time.Second,
            ExportTimeout:      5 * time.Second,
        }
    }
}
```

### 4. ç¯å¢ƒå˜é‡éªŒè¯

```go
package validation

import (
    "fmt"
    "os"
)

// ValidateEnvironmentVars éªŒè¯ç¯å¢ƒå˜é‡
func ValidateEnvironmentVars() error {
    env := os.Getenv("DEPLOYMENT_ENVIRONMENT")
    
    if env == "" {
        return fmt.Errorf("DEPLOYMENT_ENVIRONMENT not set")
    }

    // éªŒè¯ç¯å¢ƒåç§°
    validEnvs := map[string]bool{
        "production": true, "staging": true, "development": true,
        "test": true, "qa": true,
    }
    
    if !validEnvs[env] {
        return fmt.Errorf("invalid DEPLOYMENT_ENVIRONMENT: %s", env)
    }

    // ç”Ÿäº§ç¯å¢ƒé¢å¤–éªŒè¯
    if env == "production" {
        required := []string{
            "REGION",
            "K8S_CLUSTER_NAME",
            "SERVICE_VERSION",
        }
        
        for _, key := range required {
            if os.Getenv(key) == "" {
                return fmt.Errorf("required env var %s not set for production", key)
            }
        }
    }

    return nil
}

// MustValidateEnvironmentVars éªŒè¯ç¯å¢ƒå˜é‡,å¤±è´¥åˆ™panic
func MustValidateEnvironmentVars() {
    if err := ValidateEnvironmentVars(); err != nil {
        panic(fmt.Sprintf("Environment validation failed: %v", err))
    }
}
```

---

## å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£

- [OpenTelemetry Semantic Conventions - Deployment](https://opentelemetry.io/docs/specs/semconv/resource/deployment-environment/)
- [Resource Semantic Conventions](https://opentelemetry.io/docs/specs/semconv/resource/)

### ç›¸å…³å·¥å…·

- [Kubernetes Downward API](https://kubernetes.io/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/)
- [12-Factor App - Config](https://12factor.net/config)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ9æ—¥  
**ç»´æŠ¤è€…**: OTLP æ ‡å‡†åŒ–é¡¹ç›®ç»„

# LogRecordExporter å¯¼å‡ºå™¨

## ğŸ“‹ ç›®å½•

- [LogRecordExporter å¯¼å‡ºå™¨](#logrecordexporter-å¯¼å‡ºå™¨)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [æ¦‚è¿°](#æ¦‚è¿°)
  - [å†…ç½®å¯¼å‡ºå™¨](#å†…ç½®å¯¼å‡ºå™¨)
    - [1. OTLP Exporter](#1-otlp-exporter)
    - [2. Stdout Exporter](#2-stdout-exporter)
    - [3. File Exporter](#3-file-exporter)
  - [OTLP é…ç½®](#otlp-é…ç½®)
  - [Go 1.25.1 å®ç°](#go-1251-å®ç°)
    - [1. è‡ªå®šä¹‰å¯¼å‡ºå™¨](#1-è‡ªå®šä¹‰å¯¼å‡ºå™¨)
    - [2. å¤šå¯¼å‡ºå™¨](#2-å¤šå¯¼å‡ºå™¨)
  - [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
  - [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
  - [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
  - [å‚è€ƒèµ„æº](#å‚è€ƒèµ„æº)

---

## æ¦‚è¿°

**LogRecordExporter** è´Ÿè´£å°†æ—¥å¿—è®°å½•å‘é€åˆ°åç«¯ç³»ç»Ÿã€‚

```text
Processor
    â†“
Exporter.Export(logs)
    â†“ (gRPC/HTTP)
Backend
```

---

## å†…ç½®å¯¼å‡ºå™¨

### 1. OTLP Exporter

```go
import (
    "go.opentelemetry.io/otel/exporters/otlp/otlplog/otlploggrpc"
    "go.opentelemetry.io/otel/sdk/log"
)

func main() {
    exporter, _ := otlploggrpc.New(
        context.Background(),
        otlploggrpc.WithEndpoint("localhost:4317"),
        otlploggrpc.WithInsecure(),
    )
    
    processor := log.NewBatchProcessor(exporter)
    lp := log.NewLoggerProvider(
        log.WithProcessor(processor),
    )
}
```

### 2. Stdout Exporter

```go
import "go.opentelemetry.io/otel/exporters/stdout/stdoutlog"

exporter, _ := stdoutlog.New(
    stdoutlog.WithPrettyPrint(),
)
```

### 3. File Exporter

```go
// è‡ªå®šä¹‰æ–‡ä»¶å¯¼å‡ºå™¨
type FileExporter struct {
    file *os.File
}

func (e *FileExporter) Export(ctx context.Context, records []log.Record) error {
    for _, r := range records {
        fmt.Fprintf(e.file, "%s\n", formatRecord(r))
    }
    return nil
}
```

---

## OTLP é…ç½®

```go
// gRPC å¯¼å‡ºå™¨
exporter, _ := otlploggrpc.New(
    context.Background(),
    otlploggrpc.WithEndpoint("collector:4317"),
    otlploggrpc.WithTLSCredentials(...),
    otlploggrpc.WithTimeout(30*time.Second),
    otlploggrpc.WithCompressor("gzip"),
)

// HTTP å¯¼å‡ºå™¨
exporter, _ := otlploghttp.New(
    context.Background(),
    otlploghttp.WithEndpoint("collector:4318"),
    otlploghttp.WithURLPath("/v1/logs"),
)
```

---

## Go 1.25.1 å®ç°

### 1. è‡ªå®šä¹‰å¯¼å‡ºå™¨

```go
type CustomExporter struct {
    endpoint string
}

func (e *CustomExporter) Export(ctx context.Context, records []log.Record) error {
    // åºåˆ—åŒ–å¹¶å‘é€
    data, _ := json.Marshal(records)
    _, err := http.Post(e.endpoint, "application/json", bytes.NewReader(data))
    return err
}

func (e *CustomExporter) Shutdown(ctx context.Context) error {
    return nil
}

func (e *CustomExporter) ForceFlush(ctx context.Context) error {
    return nil
}
```

### 2. å¤šå¯¼å‡ºå™¨

```go
type MultiExporter struct {
    exporters []log.Exporter
}

func (e *MultiExporter) Export(ctx context.Context, records []log.Record) error {
    for _, exporter := range e.exporters {
        exporter.Export(ctx, records)
    }
    return nil
}
```

---

## æ€§èƒ½ä¼˜åŒ–

```go
// 1. å¯ç”¨å‹ç¼©
otlploggrpc.WithCompressor("gzip")

// 2. æ‰¹å¤„ç†
processor := log.NewBatchProcessor(exporter,
    log.WithExportMaxBatchSize(512),
)

// 3. é…ç½®è¶…æ—¶
otlploggrpc.WithTimeout(30*time.Second)
```

---

## æœ€ä½³å®è·µ

```go
// âœ… ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ OTLP
exporter, _ := otlploggrpc.New(
    context.Background(),
    otlploggrpc.WithEndpoint("collector:4317"),
    otlploggrpc.WithTLSCredentials(...),
)

// âœ… æ­£ç¡®å…³é—­
defer exporter.Shutdown(context.Background())

// âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡
endpoint := os.Getenv("OTEL_EXPORTER_OTLP_ENDPOINT")
```

---

## å¸¸è§é—®é¢˜

**Q1: OTLP gRPC vs HTTPï¼Ÿ**

å‚è€ƒ Tracer çš„ SpanExporter æ–‡æ¡£ã€‚

---

## å‚è€ƒèµ„æº

- [OpenTelemetry Logs SDK](https://opentelemetry.io/docs/specs/otel/logs/sdk/)
- [03_å¤„ç†å™¨.md](./03_å¤„ç†å™¨.md)

---

**ğŸ‰ å®Œæˆï¼LogRecordExporter çŸ¥è¯†æŒæ¡ï¼**

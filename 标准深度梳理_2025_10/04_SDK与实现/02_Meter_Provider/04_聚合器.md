# èšåˆå™¨ (Aggregation)

## ğŸ“‹ ç›®å½•

- [èšåˆå™¨ (Aggregation)](#èšåˆå™¨-aggregation)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [æ¦‚è¿°](#æ¦‚è¿°)
    - [ä»€ä¹ˆæ˜¯èšåˆ](#ä»€ä¹ˆæ˜¯èšåˆ)
    - [èšåˆæµç¨‹](#èšåˆæµç¨‹)
  - [å†…ç½®èšåˆå™¨](#å†…ç½®èšåˆå™¨)
    - [1. Sum](#1-sum)
    - [2. LastValue](#2-lastvalue)
    - [3. ExplicitBucketHistogram](#3-explicitbuckethistogram)
    - [4. ExponentialHistogram](#4-exponentialhistogram)
    - [5. Drop](#5-drop)
  - [æ—¶é—´æ€§ (Temporality)](#æ—¶é—´æ€§-temporality)
    - [1. Cumulative](#1-cumulative)
    - [2. Delta](#2-delta)
    - [3. é€‰æ‹©æŒ‡å—](#3-é€‰æ‹©æŒ‡å—)
  - [Go 1.25.1 å®ç°](#go-1251-å®ç°)
    - [1. è‡ªå®šä¹‰èšåˆå™¨](#1-è‡ªå®šä¹‰èšåˆå™¨)
    - [2. èšåˆå™¨é…ç½®](#2-èšåˆå™¨é…ç½®)
    - [3. æ¡ä»¶èšåˆ](#3-æ¡ä»¶èšåˆ)
  - [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
  - [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
  - [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
  - [å‚è€ƒèµ„æº](#å‚è€ƒèµ„æº)

---

## æ¦‚è¿°

### ä»€ä¹ˆæ˜¯èšåˆ

**èšåˆ (Aggregation)** æ˜¯å°†å¤šä¸ªæµ‹é‡å€¼åˆå¹¶ä¸ºå•ä¸ªæŒ‡æ ‡æ•°æ®ç‚¹çš„è¿‡ç¨‹ã€‚

```text
Measurements (åŸå§‹æ•°æ®):
  100ms, 150ms, 200ms, 120ms, 180ms...
    â†“ (èšåˆ)
Metric (èšåˆå):
  Count: 5
  Sum: 750ms
  Min: 100ms
  Max: 200ms
  Histogram: [0-100: 0, 100-200: 4, 200-300: 1]
```

### èšåˆæµç¨‹

```text
1. Instrument è®°å½•æµ‹é‡å€¼
2. Aggregation èšåˆæµ‹é‡å€¼
3. Reader å‘¨æœŸæ€§æ”¶é›†èšåˆç»“æœ
4. Exporter å¯¼å‡ºåˆ°åç«¯
```

---

## å†…ç½®èšåˆå™¨

### 1. Sum

ç´¯åŠ æ‰€æœ‰æµ‹é‡å€¼ï¼š

```go
import "go.opentelemetry.io/otel/sdk/metric"

// é…ç½® Sum èšåˆ
view := metric.NewView(
    metric.Instrument{Name: "requests.count"},
    metric.Stream{
        Aggregation: metric.AggregationSum{},
    },
)
```

**ç‰¹ç‚¹**:

```text
ç”¨é€”: Counter
è®¡ç®—: Sum = Î£(measurements)

ç¤ºä¾‹:
  Measurements: 1, 1, 1, 1, 1
  Result: Sum = 5

é€‚ç”¨åœºæ™¯:
âœ… è®¡æ•°å™¨ (è¯·æ±‚æ•°ã€é”™è¯¯æ•°)
âœ… ç´¯è®¡å€¼ (å­—èŠ‚ä¼ è¾“é‡)
```

### 2. LastValue

ä¿ç•™æœ€åä¸€ä¸ªæµ‹é‡å€¼ï¼š

```go
// é…ç½® LastValue èšåˆ
view := metric.NewView(
    metric.Instrument{Name: "memory.used"},
    metric.Stream{
        Aggregation: metric.AggregationLastValue{},
    },
)
```

**ç‰¹ç‚¹**:

```text
ç”¨é€”: Gauge
è®¡ç®—: Value = Last(measurements)

ç¤ºä¾‹:
  Measurements: 100, 150, 200, 180, 220
  Result: LastValue = 220

é€‚ç”¨åœºæ™¯:
âœ… å½“å‰å€¼ (å†…å­˜ä½¿ç”¨ã€CPU ä½¿ç”¨ç‡)
âœ… ç¬æ—¶å€¼ (æ¸©åº¦ã€é˜Ÿåˆ—é•¿åº¦)
```

### 3. ExplicitBucketHistogram

å°†æµ‹é‡å€¼åˆ†é…åˆ°é¢„å®šä¹‰çš„æ¡¶ä¸­ï¼š

```go
// é…ç½® Histogram èšåˆ
view := metric.NewView(
    metric.Instrument{Name: "http.server.duration"},
    metric.Stream{
        Aggregation: metric.AggregationExplicitBucketHistogram{
            Boundaries: []float64{0, 5, 10, 25, 50, 75, 100, 250, 500, 1000},
        },
    },
)
```

**ç‰¹ç‚¹**:

```text
ç”¨é€”: Histogram
è®¡ç®—: å°†å€¼åˆ†é…åˆ°æ¡¶

ç¤ºä¾‹ (æ¡¶: [0, 10, 100, 1000]):
  Measurements: 5, 15, 50, 150, 500
  Result:
    [0-10):    1 (5)
    [10-100):  2 (15, 50)
    [100-1000): 2 (150, 500)

é€‚ç”¨åœºæ™¯:
âœ… åˆ†å¸ƒåˆ†æ (å»¶è¿Ÿã€è¯·æ±‚å¤§å°)
âœ… ç™¾åˆ†ä½è®¡ç®— (P50, P95, P99)
```

**æ¡¶è¾¹ç•Œé…ç½®**:

```go
// HTTP å»¶è¿Ÿ (æ¯«ç§’)
Boundaries: []float64{0, 5, 10, 25, 50, 75, 100, 250, 500, 1000, 2500, 5000, 10000}

// æ•°æ®åº“æŸ¥è¯¢ (æ¯«ç§’)
Boundaries: []float64{0, 1, 2, 5, 10, 20, 50, 100, 200, 500, 1000}

// è¯·æ±‚å¤§å° (å­—èŠ‚)
Boundaries: []float64{0, 1024, 10240, 102400, 1048576, 10485760}
// 0, 1KB, 10KB, 100KB, 1MB, 10MB

// æ¨è: ä½¿ç”¨å¯¹æ•°åˆ»åº¦
Boundaries: []float64{1, 2, 5, 10, 20, 50, 100, 200, 500, 1000}
```

### 4. ExponentialHistogram

ä½¿ç”¨æŒ‡æ•°çº§æ¡¶è¾¹ç•Œï¼š

```go
// é…ç½® ExponentialHistogram
view := metric.NewView(
    metric.Instrument{Name: "http.server.duration"},
    metric.Stream{
        Aggregation: metric.AggregationBase2ExponentialHistogram{
            MaxSize:  160, // æœ€å¤§æ¡¶æ•°
            MaxScale: 20,  // æœ€å¤§ç²¾åº¦
        },
    },
)
```

**ç‰¹ç‚¹**:

```text
ç”¨é€”: Histogram (è‡ªé€‚åº”æ¡¶)
è®¡ç®—: æ¡¶è¾¹ç•Œè‡ªåŠ¨è°ƒæ•´

ä¼˜ç‚¹:
âœ… æ— éœ€é¢„å®šä¹‰æ¡¶è¾¹ç•Œ
âœ… è‡ªåŠ¨é€‚åº”æ•°æ®åˆ†å¸ƒ
âœ… æ›´é«˜çš„ç²¾åº¦

ç¼ºç‚¹:
âŒ æ›´å¤æ‚
âŒ æŸäº›åç«¯ä¸æ”¯æŒ

é€‚ç”¨åœºæ™¯:
âœ… ä¸ç¡®å®šæ•°æ®åˆ†å¸ƒ
âœ… éœ€è¦é«˜ç²¾åº¦
```

### 5. Drop

ä¸¢å¼ƒæ‰€æœ‰æµ‹é‡å€¼ï¼š

```go
// ç¦ç”¨æŒ‡æ ‡
view := metric.NewView(
    metric.Instrument{Name: "debug.metric"},
    metric.Stream{
        Aggregation: metric.AggregationDrop{},
    },
)
```

**ç‰¹ç‚¹**:

```text
ç”¨é€”: ç¦ç”¨æŒ‡æ ‡
è®¡ç®—: ä¸¢å¼ƒæ‰€æœ‰æ•°æ®

é€‚ç”¨åœºæ™¯:
âœ… ç”Ÿäº§ç¯å¢ƒç¦ç”¨è°ƒè¯•æŒ‡æ ‡
âœ… ä¸´æ—¶ç¦ç”¨æŸäº›æŒ‡æ ‡
```

---

## æ—¶é—´æ€§ (Temporality)

### 1. Cumulative

ç´¯ç§¯æ¨¡å¼ï¼ˆä»å¼€å§‹ç´¯è®¡ï¼‰ï¼š

```text
æ—¶é—´: 0s    10s   20s   30s
å€¼:   0     100   250   400

å¯¼å‡º:
  t=10s: 100  (0åˆ°10sçš„ç´¯è®¡)
  t=20s: 250  (0åˆ°20sçš„ç´¯è®¡)
  t=30s: 400  (0åˆ°30sçš„ç´¯è®¡)

ç‰¹ç‚¹:
âœ… ç®€å•æ˜“ç†è§£
âœ… åç«¯å¯ä»¥è®¡ç®—ä»»æ„æ—¶é—´æ®µçš„å˜åŒ–
âŒ éœ€è¦æ›´å¤šå­˜å‚¨ç©ºé—´
```

### 2. Delta

å¢é‡æ¨¡å¼ï¼ˆæ¯ä¸ªå‘¨æœŸçš„å˜åŒ–ï¼‰ï¼š

```text
æ—¶é—´: 0s    10s   20s   30s
å€¼:   0     100   250   400

å¯¼å‡º:
  t=10s: 100  (0åˆ°10sçš„å¢é‡)
  t=20s: 150  (10åˆ°20sçš„å¢é‡)
  t=30s: 150  (20åˆ°30sçš„å¢é‡)

ç‰¹ç‚¹:
âœ… èŠ‚çœå­˜å‚¨ç©ºé—´
âœ… ç½‘ç»œä¼ è¾“æ›´å°‘
âŒ æ— æ³•é‡æ–°è®¡ç®—å†å²æ•°æ®
```

### 3. é€‰æ‹©æŒ‡å—

```go
// é…ç½® Temporality
reader := metric.NewPeriodicReader(
    exporter,
    metric.WithTemporalitySelector(func(ik metric.InstrumentKind) metricdata.Temporality {
        switch ik {
        case metric.InstrumentKindCounter,
             metric.InstrumentKindUpDownCounter,
             metric.InstrumentKindHistogram:
            return metricdata.CumulativeTemporality // Cumulative
        case metric.InstrumentKindObservableCounter,
             metric.InstrumentKindObservableUpDownCounter,
             metric.InstrumentKindObservableGauge:
            return metricdata.CumulativeTemporality // Cumulative
        default:
            return metricdata.CumulativeTemporality
        }
    }),
)
```

**é€‰æ‹©å»ºè®®**:

```text
Cumulative:
âœ… Prometheus
âœ… é•¿æœŸå­˜å‚¨
âœ… éœ€è¦çµæ´»æŸ¥è¯¢

Delta:
âœ… èŠ‚çœç½‘ç»œå¸¦å®½
âœ… å®æ—¶ç›‘æ§
âœ… StatsD é£æ ¼

æ¨è:
- é»˜è®¤ä½¿ç”¨ Cumulative
- ç‰¹æ®Šéœ€æ±‚ä½¿ç”¨ Delta
```

---

## Go 1.25.1 å®ç°

### 1. è‡ªå®šä¹‰èšåˆå™¨

```go
package aggregation

import (
    "go.opentelemetry.io/otel/sdk/metric"
    "go.opentelemetry.io/otel/sdk/metric/metricdata"
)

// CustomAggregation è‡ªå®šä¹‰èšåˆå™¨æ¥å£
type CustomAggregation interface {
    // Aggregate èšåˆæµ‹é‡å€¼
    Aggregate(value float64)
    
    // Snapshot è·å–èšåˆç»“æœ
    Snapshot() metricdata.DataPoint
    
    // Reset é‡ç½®èšåˆå™¨
    Reset()
}

// MinMaxAggregation æœ€å°æœ€å¤§å€¼èšåˆ
type MinMaxAggregation struct {
    min   float64
    max   float64
    count int64
}

func NewMinMaxAggregation() *MinMaxAggregation {
    return &MinMaxAggregation{
        min: math.MaxFloat64,
        max: -math.MaxFloat64,
    }
}

func (a *MinMaxAggregation) Aggregate(value float64) {
    a.count++
    if value < a.min {
        a.min = value
    }
    if value > a.max {
        a.max = value
    }
}

func (a *MinMaxAggregation) Snapshot() (min, max float64, count int64) {
    return a.min, a.max, a.count
}

func (a *MinMaxAggregation) Reset() {
    a.min = math.MaxFloat64
    a.max = -math.MaxFloat64
    a.count = 0
}

// ä½¿ç”¨ç¤ºä¾‹
type MinMaxInstrument struct {
    agg *MinMaxAggregation
}

func (i *MinMaxInstrument) Record(ctx context.Context, value float64, attrs ...attribute.KeyValue) {
    i.agg.Aggregate(value)
}
```

### 2. èšåˆå™¨é…ç½®

```go
package aggregation

// AggregationConfig èšåˆå™¨é…ç½®
type AggregationConfig struct {
    Type       AggregationType
    Boundaries []float64 // for Histogram
    MaxSize    int       // for ExponentialHistogram
    MaxScale   int       // for ExponentialHistogram
}

type AggregationType int

const (
    AggregationTypeSum AggregationType = iota
    AggregationTypeLastValue
    AggregationTypeHistogram
    AggregationTypeExponentialHistogram
    AggregationTypeDrop
)

// NewAggregation åˆ›å»ºèšåˆå™¨
func NewAggregation(cfg AggregationConfig) metric.Aggregation {
    switch cfg.Type {
    case AggregationTypeSum:
        return metric.AggregationSum{}
    case AggregationTypeLastValue:
        return metric.AggregationLastValue{}
    case AggregationTypeHistogram:
        return metric.AggregationExplicitBucketHistogram{
            Boundaries: cfg.Boundaries,
        }
    case AggregationTypeExponentialHistogram:
        return metric.AggregationBase2ExponentialHistogram{
            MaxSize:  cfg.MaxSize,
            MaxScale: cfg.MaxScale,
        }
    case AggregationTypeDrop:
        return metric.AggregationDrop{}
    default:
        return metric.AggregationDefault{}
    }
}

// ä½¿ç”¨ç¤ºä¾‹
func createHTTPViews() []metric.View {
    return []metric.View{
        metric.NewView(
            metric.Instrument{Name: "http.server.duration"},
            metric.Stream{
                Aggregation: NewAggregation(AggregationConfig{
                    Type:       AggregationTypeHistogram,
                    Boundaries: []float64{0, 5, 10, 25, 50, 100, 250, 500, 1000},
                }),
            },
        ),
    }
}
```

### 3. æ¡ä»¶èšåˆ

```go
package aggregation

// ConditionalAggregation æ¡ä»¶èšåˆ
func ConditionalAggregation(instrumentName string) metric.Aggregation {
    switch {
    case strings.HasSuffix(instrumentName, ".duration"):
        // å»¶è¿Ÿç±»æŒ‡æ ‡ä½¿ç”¨ Histogram
        return metric.AggregationExplicitBucketHistogram{
            Boundaries: []float64{0, 5, 10, 25, 50, 100, 250, 500, 1000},
        }
    case strings.HasSuffix(instrumentName, ".size"):
        // å¤§å°ç±»æŒ‡æ ‡ä½¿ç”¨ Histogram (å­—èŠ‚)
        return metric.AggregationExplicitBucketHistogram{
            Boundaries: []float64{0, 1024, 10240, 102400, 1048576, 10485760},
        }
    case strings.HasSuffix(instrumentName, ".count"):
        // è®¡æ•°ç±»æŒ‡æ ‡ä½¿ç”¨ Sum
        return metric.AggregationSum{}
    case strings.HasSuffix(instrumentName, ".current"):
        // å½“å‰å€¼ç±»æŒ‡æ ‡ä½¿ç”¨ LastValue
        return metric.AggregationLastValue{}
    default:
        return metric.AggregationDefault{}
    }
}

// ä½¿ç”¨ç¤ºä¾‹
view := metric.NewView(
    metric.Instrument{Name: "*"},
    metric.Stream{
        Aggregation: ConditionalAggregation("http.server.duration"),
    },
)
```

---

## æ€§èƒ½ä¼˜åŒ–

```go
// 1. å‡å°‘ Histogram æ¡¶æ•°é‡
// âŒ å¤ªå¤šæ¡¶
Boundaries: []float64{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, ..., 100} // 100ä¸ªæ¡¶ï¼

// âœ… åˆç†æ•°é‡
Boundaries: []float64{1, 10, 100, 1000} // 4ä¸ªæ¡¶

// 2. ä½¿ç”¨ Drop ç¦ç”¨ä¸éœ€è¦çš„æŒ‡æ ‡
view := metric.NewView(
    metric.Instrument{Name: "debug.*"},
    metric.Stream{
        Aggregation: metric.AggregationDrop{},
    },
)

// 3. é€‰æ‹©åˆé€‚çš„èšåˆç±»å‹
// å¯¹äºç®€å•è®¡æ•°ï¼Œä½¿ç”¨ Sumï¼ˆæœ€å¿«ï¼‰
view := metric.NewView(
    metric.Instrument{Name: "requests.count"},
    metric.Stream{
        Aggregation: metric.AggregationSum{}, // å¿«
    },
)

// 4. é¿å…è¿‡åº¦ç²¾ç»†çš„æ¡¶
// âŒ è¿‡åº¦ç²¾ç»†
Boundaries: []float64{0, 1, 2, 3, 4, 5, ..., 1000} // å¤ªå¤šï¼

// âœ… åˆç†ç²¾åº¦
Boundaries: []float64{0, 10, 50, 100, 500, 1000} // å¤Ÿç”¨

// 5. æ ¹æ®ç¯å¢ƒè°ƒæ•´
func getAggregation(env string) metric.Aggregation {
    if env == "production" {
        // ç”Ÿäº§ç¯å¢ƒï¼šç®€å•æ¡¶
        return metric.AggregationExplicitBucketHistogram{
            Boundaries: []float64{10, 100, 1000},
        }
    }
    // å¼€å‘ç¯å¢ƒï¼šè¯¦ç»†æ¡¶
    return metric.AggregationExplicitBucketHistogram{
        Boundaries: []float64{1, 5, 10, 25, 50, 100, 250, 500, 1000, 2500, 5000},
    }
}
```

---

## æœ€ä½³å®è·µ

```go
// âœ… æ­£ç¡®: ä¸ºå»¶è¿Ÿä½¿ç”¨ Histogram
view := metric.NewView(
    metric.Instrument{Name: "http.server.duration"},
    metric.Stream{
        Aggregation: metric.AggregationExplicitBucketHistogram{
            Boundaries: []float64{0, 5, 10, 25, 50, 100, 250, 500, 1000},
        },
    },
)

// âœ… æ­£ç¡®: ä¸ºè®¡æ•°å™¨ä½¿ç”¨ Sum
view := metric.NewView(
    metric.Instrument{Name: "requests.count"},
    metric.Stream{
        Aggregation: metric.AggregationSum{},
    },
)

// âœ… æ­£ç¡®: ä¸ºå½“å‰å€¼ä½¿ç”¨ LastValue
view := metric.NewView(
    metric.Instrument{Name: "memory.used"},
    metric.Stream{
        Aggregation: metric.AggregationLastValue{},
    },
)

// âœ… æ­£ç¡®: ä½¿ç”¨å¯¹æ•°åˆ»åº¦çš„æ¡¶
Boundaries: []float64{1, 2, 5, 10, 20, 50, 100, 200, 500, 1000}

// âŒ é”™è¯¯: ä½¿ç”¨çº¿æ€§åˆ»åº¦ï¼ˆå¯¹å¤§èŒƒå›´ä¸å‹å¥½ï¼‰
Boundaries: []float64{10, 20, 30, 40, 50, ..., 1000}

// âœ… æ­£ç¡®: æ¡¶è¾¹ç•Œè¦è¦†ç›–é¢„æœŸèŒƒå›´
// HTTP å»¶è¿Ÿé€šå¸¸åœ¨ 0-1000msï¼Œæ‰€ä»¥:
Boundaries: []float64{0, 5, 10, 25, 50, 100, 250, 500, 1000}

// âŒ é”™è¯¯: æ¡¶è¾¹ç•ŒèŒƒå›´ä¸åˆç†
Boundaries: []float64{0, 1, 2, 3, 4, 5} // å¤ªå°ï¼å¤§éƒ¨åˆ†å€¼ä¼šè¶…å‡º

// âœ… æ­£ç¡®: ç¦ç”¨è°ƒè¯•æŒ‡æ ‡
view := metric.NewView(
    metric.Instrument{Name: "debug.*"},
    metric.Stream{
        Aggregation: metric.AggregationDrop{},
    },
)
```

---

## å¸¸è§é—®é¢˜

**Q1: å¦‚ä½•é€‰æ‹©èšåˆç±»å‹ï¼Ÿ**

```text
Sum:
âœ… Counter
âœ… ç´¯è®¡å€¼ (æ€»è¯·æ±‚æ•°ã€æ€»å­—èŠ‚æ•°)

LastValue:
âœ… Gauge
âœ… å½“å‰å€¼ (å†…å­˜ä½¿ç”¨ã€CPUä½¿ç”¨ç‡ã€é˜Ÿåˆ—é•¿åº¦)

Histogram:
âœ… åˆ†å¸ƒåˆ†æ
âœ… å»¶è¿Ÿã€å¤§å°ã€æŒç»­æ—¶é—´

ExponentialHistogram:
âœ… ä¸ç¡®å®šæ•°æ®åˆ†å¸ƒ
âœ… éœ€è¦é«˜ç²¾åº¦

Drop:
âœ… ç¦ç”¨æŒ‡æ ‡
```

**Q2: Histogram æ¡¶å¦‚ä½•é…ç½®ï¼Ÿ**

```text
åŸåˆ™:
1. è¦†ç›–é¢„æœŸèŒƒå›´
   - HTTP: 0-10,000ms
   - DB: 0-1,000ms

2. ä½¿ç”¨å¯¹æ•°åˆ»åº¦
   - 1, 2, 5, 10, 20, 50, 100...
   - è€Œä¸æ˜¯ 10, 20, 30, 40...

3. åˆç†çš„æ¡¶æ•°é‡
   - æ¨è: 5-15ä¸ªæ¡¶
   - å¤ªå°‘: ç²¾åº¦ä½
   - å¤ªå¤š: æ€§èƒ½å·®

4. æ ¹æ®éœ€æ±‚è°ƒæ•´
   - SLA æ˜¯ 100ms? åœ¨ 100ms é™„è¿‘å¢åŠ æ¡¶
   - 99% è¯·æ±‚ < 500ms? åœ¨ 500ms å‰å¤šè®¾æ¡¶
```

**Q3: Cumulative vs Deltaï¼Ÿ**

```text
Cumulative (æ¨è):
âœ… ä¼˜ç‚¹:
  - ç®€å•æ˜“ç†è§£
  - åç«¯å¯ä»¥çµæ´»æŸ¥è¯¢
  - Prometheus æ ‡å‡†
  
âŒ ç¼ºç‚¹:
  - éœ€è¦æ›´å¤šå­˜å‚¨

Delta:
âœ… ä¼˜ç‚¹:
  - èŠ‚çœå­˜å‚¨å’Œå¸¦å®½
  - å®æ—¶ç›‘æ§
  
âŒ ç¼ºç‚¹:
  - æ— æ³•é‡ç®—å†å²
  - éœ€è¦åç«¯æ”¯æŒ

æ¨è:
- é»˜è®¤: Cumulative
- ç‰¹æ®Šéœ€æ±‚: Delta
```

**Q4: å¦‚ä½•éªŒè¯èšåˆé…ç½®ï¼Ÿ**

```go
// ä½¿ç”¨ stdout exporter æŸ¥çœ‹
exporter, _ := stdoutmetric.New(
    stdoutmetric.WithPrettyPrint(),
)

mp := metric.NewMeterProvider(
    metric.WithReader(metric.NewPeriodicReader(exporter)),
    metric.WithView(yourView),
)

// è®°å½•ä¸€äº›æ•°æ®
meter := mp.Meter("test")
histogram, _ := meter.Float64Histogram("test.duration")
histogram.Record(context.Background(), 50)
histogram.Record(context.Background(), 150)
histogram.Record(context.Background(), 500)

// ç­‰å¾…å¯¼å‡ºï¼ŒæŸ¥çœ‹è¾“å‡º
time.Sleep(2 * time.Second)

// æ£€æŸ¥:
// 1. æ¡¶åˆ†å¸ƒæ˜¯å¦åˆç†
// 2. æ˜¯å¦æœ‰æ•°æ®è½åœ¨æ­£ç¡®çš„æ¡¶ä¸­
// 3. Sum, Count æ˜¯å¦æ­£ç¡®
```

---

## å‚è€ƒèµ„æº

- [OpenTelemetry Aggregation](https://opentelemetry.io/docs/specs/otel/metrics/sdk/#aggregation)
- [Go SDK Aggregation](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/metric#Aggregation)
- [03_è§†å›¾é…ç½®.md](./03_è§†å›¾é…ç½®.md)
- [05_å¯¼å‡ºå™¨.md](./05_å¯¼å‡ºå™¨.md)

---

**ğŸ‰ æ­å–œï¼ä½ å·²ç»æŒæ¡äº†èšåˆå™¨çš„å®Œæ•´çŸ¥è¯†ï¼**

ç°åœ¨ä½ å¯ä»¥ï¼š

- âœ… ç†è§£å„ç§èšåˆç±»å‹
- âœ… é…ç½® Histogram æ¡¶
- âœ… é€‰æ‹©åˆé€‚çš„ Temporality
- âœ… å®ç°è‡ªå®šä¹‰èšåˆå™¨
- âœ… ä¼˜åŒ–èšåˆæ€§èƒ½

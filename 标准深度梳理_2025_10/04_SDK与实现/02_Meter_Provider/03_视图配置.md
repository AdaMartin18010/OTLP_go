# è§†å›¾é…ç½® (View)

## ðŸ“‹ ç›®å½•

- [è§†å›¾é…ç½® (View)](#è§†å›¾é…ç½®-view)
  - [ðŸ“‹ ç›®å½•](#-ç›®å½•)
  - [æ¦‚è¿°](#æ¦‚è¿°)
    - [ä»€ä¹ˆæ˜¯ View](#ä»€ä¹ˆæ˜¯-view)
    - [View çš„ä½œç”¨](#view-çš„ä½œç”¨)
  - [åŸºæœ¬é…ç½®](#åŸºæœ¬é…ç½®)
    - [1. åˆ›å»º View](#1-åˆ›å»º-view)
    - [2. æ³¨å†Œ View](#2-æ³¨å†Œ-view)
    - [3. å¤šä¸ª View](#3-å¤šä¸ª-view)
  - [é€‰æ‹©å™¨ (Selector)](#é€‰æ‹©å™¨-selector)
    - [1. æŒ‰åç§°é€‰æ‹©](#1-æŒ‰åç§°é€‰æ‹©)
    - [2. æŒ‰é€šé…ç¬¦é€‰æ‹©](#2-æŒ‰é€šé…ç¬¦é€‰æ‹©)
    - [3. æŒ‰ç±»åž‹é€‰æ‹©](#3-æŒ‰ç±»åž‹é€‰æ‹©)
  - [èšåˆé…ç½®](#èšåˆé…ç½®)
    - [1. æ›´æ”¹èšåˆç±»åž‹](#1-æ›´æ”¹èšåˆç±»åž‹)
    - [2. Histogram æ¡¶é…ç½®](#2-histogram-æ¡¶é…ç½®)
    - [3. ç¦ç”¨æŒ‡æ ‡](#3-ç¦ç”¨æŒ‡æ ‡)
  - [å±žæ€§è¿‡æ»¤](#å±žæ€§è¿‡æ»¤)
    - [1. ä¿ç•™ç‰¹å®šå±žæ€§](#1-ä¿ç•™ç‰¹å®šå±žæ€§)
    - [2. åˆ é™¤å±žæ€§](#2-åˆ é™¤å±žæ€§)
    - [3. å±žæ€§é‡å‘½å](#3-å±žæ€§é‡å‘½å)
  - [Go 1.25.1 å®žçŽ°](#go-1251-å®žçŽ°)
    - [1. åŠ¨æ€ View](#1-åŠ¨æ€-view)
    - [2. View æž„å»ºå™¨](#2-view-æž„å»ºå™¨)
    - [3. View é“¾](#3-view-é“¾)
  - [é«˜çº§æ¨¡å¼](#é«˜çº§æ¨¡å¼)
    - [1. é™ä½ŽåŸºæ•°](#1-é™ä½ŽåŸºæ•°)
    - [2. æ€§èƒ½ä¼˜åŒ–](#2-æ€§èƒ½ä¼˜åŒ–)
    - [3. æˆæœ¬æŽ§åˆ¶](#3-æˆæœ¬æŽ§åˆ¶)
  - [æœ€ä½³å®žè·µ](#æœ€ä½³å®žè·µ)
  - [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
  - [å‚è€ƒèµ„æº](#å‚è€ƒèµ„æº)

---

## æ¦‚è¿°

### ä»€ä¹ˆæ˜¯ View

**View** æ˜¯ OpenTelemetry Metrics çš„é…ç½®æœºåˆ¶ï¼Œç”¨äºŽè‡ªå®šä¹‰æŒ‡æ ‡çš„è¡Œä¸ºï¼Œè€Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚

```text
Instrument (åŽŸå§‹)
    â†“
View (è½¬æ¢/è¿‡æ»¤)
    â†“
Metric (æœ€ç»ˆå¯¼å‡º)
```

### View çš„ä½œç”¨

```text
View å¯ä»¥:
1. æ›´æ”¹æŒ‡æ ‡åç§°
2. æ›´æ”¹æŒ‡æ ‡æè¿°
3. æ›´æ”¹èšåˆæ–¹å¼
4. è¿‡æ»¤/ä¿ç•™å±žæ€§
5. é…ç½® Histogram æ¡¶
6. ç¦ç”¨ç‰¹å®šæŒ‡æ ‡
```

---

## åŸºæœ¬é…ç½®

### 1. åˆ›å»º View

```go
import (
    "go.opentelemetry.io/otel/sdk/metric"
)

// åˆ›å»º View
view := metric.NewView(
    // Selector: é€‰æ‹©è¦åº”ç”¨çš„ Instrument
    metric.Instrument{
        Name: "http.server.duration",
    },
    // Stream: é…ç½®è¾“å‡º
    metric.Stream{
        Name:        "http.server.request.duration", // é‡å‘½å
        Description: "HTTP request duration in milliseconds",
        Unit:        "ms",
    },
)
```

### 2. æ³¨å†Œ View

```go
// åœ¨åˆ›å»º MeterProvider æ—¶æ³¨å†Œ View
mp := metric.NewMeterProvider(
    metric.WithReader(reader),
    metric.WithView(view), // æ³¨å†Œ View
)
```

### 3. å¤šä¸ª View

```go
// æ³¨å†Œå¤šä¸ª View
mp := metric.NewMeterProvider(
    metric.WithReader(reader),
    metric.WithView(view1),
    metric.WithView(view2),
    metric.WithView(view3),
)
```

---

## é€‰æ‹©å™¨ (Selector)

### 1. æŒ‰åç§°é€‰æ‹©

```go
// ç²¾ç¡®åŒ¹é…
view := metric.NewView(
    metric.Instrument{
        Name: "http.server.duration",
    },
    metric.Stream{
        Name: "http.request.duration",
    },
)

// åŒ¹é…å¤šä¸ª Instrument (ä½¿ç”¨é€šé…ç¬¦)
view := metric.NewView(
    metric.Instrument{
        Name: "http.*", // åŒ¹é…æ‰€æœ‰ä»¥ http. å¼€å¤´çš„æŒ‡æ ‡
    },
    metric.Stream{
        // é…ç½®
    },
)
```

### 2. æŒ‰é€šé…ç¬¦é€‰æ‹©

```go
// åŒ¹é…æ‰€æœ‰æŒ‡æ ‡
view := metric.NewView(
    metric.Instrument{
        Name: "*",
    },
    metric.Stream{
        // åº”ç”¨äºŽæ‰€æœ‰æŒ‡æ ‡
    },
)

// åŒ¹é…å‰ç¼€
view := metric.NewView(
    metric.Instrument{
        Name: "database.*",
    },
    metric.Stream{
        // åº”ç”¨äºŽæ‰€æœ‰ database.* æŒ‡æ ‡
    },
)
```

### 3. æŒ‰ç±»åž‹é€‰æ‹©

```go
// é€‰æ‹©ç‰¹å®šç±»åž‹çš„ Instrument
view := metric.NewView(
    metric.Instrument{
        Kind: metric.InstrumentKindHistogram,
    },
    metric.Stream{
        // åº”ç”¨äºŽæ‰€æœ‰ Histogram
    },
)

// é€‰æ‹©ç‰¹å®š Scope
view := metric.NewView(
    metric.Instrument{
        Scope: instrumentation.Scope{
            Name: "myapp/api",
        },
    },
    metric.Stream{
        // åº”ç”¨äºŽç‰¹å®š Scope çš„æŒ‡æ ‡
    },
)
```

---

## èšåˆé…ç½®

### 1. æ›´æ”¹èšåˆç±»åž‹

```go
import (
    "go.opentelemetry.io/otel/sdk/metric"
)

// Counter â†’ Sum
view := metric.NewView(
    metric.Instrument{Name: "requests"},
    metric.Stream{
        Aggregation: metric.AggregationSum{},
    },
)

// Histogram â†’ LastValue (è½¬æ¢ä¸º Gauge)
view := metric.NewView(
    metric.Instrument{Name: "memory.used"},
    metric.Stream{
        Aggregation: metric.AggregationLastValue{},
    },
)

// Histogram â†’ ExplicitBucketHistogram
view := metric.NewView(
    metric.Instrument{Name: "http.server.duration"},
    metric.Stream{
        Aggregation: metric.AggregationExplicitBucketHistogram{
            Boundaries: []float64{0, 5, 10, 25, 50, 75, 100, 250, 500, 1000},
        },
    },
)
```

### 2. Histogram æ¡¶é…ç½®

```go
// è‡ªå®šä¹‰ Histogram æ¡¶
view := metric.NewView(
    metric.Instrument{Name: "http.server.duration"},
    metric.Stream{
        Aggregation: metric.AggregationExplicitBucketHistogram{
            Boundaries: []float64{
                10, 50, 100,    // å¿«é€Ÿå“åº”: 10-100ms
                500, 1000,      // æ­£å¸¸å“åº”: 500ms-1s
                5000, 10000,    // æ…¢å“åº”: 5-10s
            },
        },
    },
)

// æŽ¨èçš„æ¡¶ï¼ˆä¸åŒåœºæ™¯ï¼‰
var (
    // HTTP å»¶è¿Ÿ (æ¯«ç§’)
    HTTPLatencyBoundaries = []float64{0, 5, 10, 25, 50, 75, 100, 250, 500, 1000, 2500, 5000, 10000}
    
    // æ•°æ®åº“æŸ¥è¯¢å»¶è¿Ÿ (æ¯«ç§’)
    DBQueryBoundaries = []float64{0, 1, 2, 5, 10, 20, 50, 100, 200, 500, 1000}
    
    // è¯·æ±‚å¤§å° (å­—èŠ‚)
    SizeBoundaries = []float64{0, 1024, 10240, 102400, 1048576, 10485760} // 0, 1KB, 10KB, 100KB, 1MB, 10MB
)
```

### 3. ç¦ç”¨æŒ‡æ ‡

```go
// ç¦ç”¨ç‰¹å®šæŒ‡æ ‡
view := metric.NewView(
    metric.Instrument{Name: "debug.metric"},
    metric.Stream{
        Aggregation: metric.AggregationDrop{}, // ä¸¢å¼ƒæŒ‡æ ‡
    },
)

// ç¦ç”¨æ‰€æœ‰ä»¥ debug. å¼€å¤´çš„æŒ‡æ ‡
view := metric.NewView(
    metric.Instrument{Name: "debug.*"},
    metric.Stream{
        Aggregation: metric.AggregationDrop{},
    },
)
```

---

## å±žæ€§è¿‡æ»¤

### 1. ä¿ç•™ç‰¹å®šå±žæ€§

```go
// åªä¿ç•™æŒ‡å®šå±žæ€§
view := metric.NewView(
    metric.Instrument{Name: "http.server.duration"},
    metric.Stream{
        AttributeFilter: func(kv attribute.KeyValue) bool {
            // åªä¿ç•™ method, route, status_code
            key := string(kv.Key)
            return key == "http.method" || 
                   key == "http.route" || 
                   key == "http.status_code"
        },
    },
)
```

### 2. åˆ é™¤å±žæ€§

```go
// åˆ é™¤é«˜åŸºæ•°å±žæ€§
view := metric.NewView(
    metric.Instrument{Name: "http.server.duration"},
    metric.Stream{
        AttributeFilter: func(kv attribute.KeyValue) bool {
            // åˆ é™¤ user_id (é«˜åŸºæ•°)
            return string(kv.Key) != "user.id"
        },
    },
)

// åˆ é™¤æ•æ„Ÿä¿¡æ¯
view := metric.NewView(
    metric.Instrument{Name: "*"},
    metric.Stream{
        AttributeFilter: func(kv attribute.KeyValue) bool {
            key := string(kv.Key)
            // åˆ é™¤æ‰€æœ‰åŒ…å« "password", "token" çš„å±žæ€§
            return !strings.Contains(key, "password") && 
                   !strings.Contains(key, "token")
        },
    },
)
```

### 3. å±žæ€§é‡å‘½å

```go
// æ³¨æ„ï¼šOpenTelemetry ä¸ç›´æŽ¥æ”¯æŒå±žæ€§é‡å‘½å
// éœ€è¦åœ¨åº”ç”¨å±‚é¢å¤„ç†ï¼Œæˆ–ä½¿ç”¨ Collector Processor

// æ–¹æ¡ˆï¼šé€šè¿‡è‡ªå®šä¹‰ Exporter å®žçŽ°
type RenamingExporter struct {
    next metric.Exporter
}

func (e *RenamingExporter) Export(ctx context.Context, rm *metricdata.ResourceMetrics) error {
    // éåŽ†å¹¶é‡å‘½åå±žæ€§
    for _, sm := range rm.ScopeMetrics {
        for _, m := range sm.Metrics {
            for _, dp := range m.Data.(metricdata.Histogram).DataPoints {
                newAttrs := []attribute.KeyValue{}
                for _, attr := range dp.Attributes.ToSlice() {
                    if string(attr.Key) == "old_name" {
                        newAttrs = append(newAttrs, attribute.String("new_name", attr.Value.AsString()))
                    } else {
                        newAttrs = append(newAttrs, attr)
                    }
                }
                dp.Attributes = attribute.NewSet(newAttrs...)
            }
        }
    }
    return e.next.Export(ctx, rm)
}
```

---

## Go 1.25.1 å®žçŽ°

### 1. åŠ¨æ€ View

```go
package metrics

import (
    "sync"
)

// DynamicViewManager åŠ¨æ€ View ç®¡ç†å™¨
type DynamicViewManager struct {
    mu    sync.RWMutex
    views []metric.View
}

func NewDynamicViewManager() *DynamicViewManager {
    return &DynamicViewManager{
        views: make([]metric.View, 0),
    }
}

// AddView æ·»åŠ  View
func (m *DynamicViewManager) AddView(view metric.View) {
    m.mu.Lock()
    defer m.mu.Unlock()
    m.views = append(m.views, view)
}

// GetViews èŽ·å–æ‰€æœ‰ View
func (m *DynamicViewManager) GetViews() []metric.View {
    m.mu.RLock()
    defer m.mu.RUnlock()
    return append([]metric.View{}, m.views...)
}

// ä½¿ç”¨ç¤ºä¾‹
func main() {
    manager := NewDynamicViewManager()
    
    // åŠ¨æ€æ·»åŠ  View
    manager.AddView(metric.NewView(...))
    
    // åˆ›å»º MeterProvider
    mp := metric.NewMeterProvider(
        metric.WithReader(reader),
        metric.WithView(manager.GetViews()...),
    )
}
```

### 2. View æž„å»ºå™¨

```go
package metrics

// ViewBuilder View æž„å»ºå™¨
type ViewBuilder struct {
    instrumentName string
    instrumentKind metric.InstrumentKind
    streamName     string
    description    string
    unit           string
    aggregation    metric.Aggregation
    attrFilter     attribute.Filter
}

func NewViewBuilder() *ViewBuilder {
    return &ViewBuilder{}
}

func (b *ViewBuilder) ForInstrument(name string) *ViewBuilder {
    b.instrumentName = name
    return b
}

func (b *ViewBuilder) WithName(name string) *ViewBuilder {
    b.streamName = name
    return b
}

func (b *ViewBuilder) WithDescription(desc string) *ViewBuilder {
    b.description = desc
    return b
}

func (b *ViewBuilder) WithUnit(unit string) *ViewBuilder {
    b.unit = unit
    return b
}

func (b *ViewBuilder) WithAggregation(agg metric.Aggregation) *ViewBuilder {
    b.aggregation = agg
    return b
}

func (b *ViewBuilder) WithAttributeFilter(filter attribute.Filter) *ViewBuilder {
    b.attrFilter = filter
    return b
}

func (b *ViewBuilder) Build() metric.View {
    return metric.NewView(
        metric.Instrument{
            Name: b.instrumentName,
            Kind: b.instrumentKind,
        },
        metric.Stream{
            Name:            b.streamName,
            Description:     b.description,
            Unit:            b.unit,
            Aggregation:     b.aggregation,
            AttributeFilter: b.attrFilter,
        },
    )
}

// ä½¿ç”¨ç¤ºä¾‹
view := NewViewBuilder().
    ForInstrument("http.server.duration").
    WithName("http.request.duration").
    WithDescription("HTTP request duration").
    WithUnit("ms").
    WithAggregation(metric.AggregationExplicitBucketHistogram{
        Boundaries: []float64{0, 5, 10, 25, 50, 100, 250, 500, 1000},
    }).
    WithAttributeFilter(func(kv attribute.KeyValue) bool {
        key := string(kv.Key)
        return key == "http.method" || key == "http.route"
    }).
    Build()
```

### 3. View é“¾

```go
package metrics

// ViewChain View é“¾
type ViewChain struct {
    views []metric.View
}

func NewViewChain() *ViewChain {
    return &ViewChain{
        views: make([]metric.View, 0),
    }
}

func (c *ViewChain) Add(view metric.View) *ViewChain {
    c.views = append(c.views, view)
    return c
}

func (c *ViewChain) AddHTTPViews() *ViewChain {
    // HTTP ç›¸å…³ View
    c.Add(metric.NewView(
        metric.Instrument{Name: "http.server.duration"},
        metric.Stream{
            Aggregation: metric.AggregationExplicitBucketHistogram{
                Boundaries: HTTPLatencyBoundaries,
            },
        },
    ))
    return c
}

func (c *ViewChain) AddDBViews() *ViewChain {
    // æ•°æ®åº“ç›¸å…³ View
    c.Add(metric.NewView(
        metric.Instrument{Name: "db.query.duration"},
        metric.Stream{
            Aggregation: metric.AggregationExplicitBucketHistogram{
                Boundaries: DBQueryBoundaries,
            },
        },
    ))
    return c
}

func (c *ViewChain) RemoveHighCardinalityAttributes() *ViewChain {
    c.Add(metric.NewView(
        metric.Instrument{Name: "*"},
        metric.Stream{
            AttributeFilter: func(kv attribute.KeyValue) bool {
                key := string(kv.Key)
                // åˆ é™¤å¸¸è§çš„é«˜åŸºæ•°å±žæ€§
                return key != "user.id" && 
                       key != "trace.id" && 
                       key != "span.id"
            },
        },
    ))
    return c
}

func (c *ViewChain) Build() []metric.View {
    return c.views
}

// ä½¿ç”¨ç¤ºä¾‹
views := NewViewChain().
    AddHTTPViews().
    AddDBViews().
    RemoveHighCardinalityAttributes().
    Build()

mp := metric.NewMeterProvider(
    metric.WithReader(reader),
    metric.WithView(views...),
)
```

---

## é«˜çº§æ¨¡å¼

### 1. é™ä½ŽåŸºæ•°

```go
// é—®é¢˜ï¼šURL è·¯å¾„å¯¼è‡´é«˜åŸºæ•°
// åŽŸå§‹: /users/123, /users/456, /users/789...

// æ–¹æ¡ˆ 1: è¿‡æ»¤ URL å‚æ•°
view := metric.NewView(
    metric.Instrument{Name: "http.server.duration"},
    metric.Stream{
        AttributeFilter: func(kv attribute.KeyValue) bool {
            // ä¿ç•™ route (æ¨¡æ¿)ï¼Œåˆ é™¤ target (å®žé™…è·¯å¾„)
            return string(kv.Key) != "http.target"
        },
    },
)

// æ–¹æ¡ˆ 2: åœ¨åº”ç”¨å±‚è§„èŒƒåŒ–
func recordHTTPMetric(ctx context.Context, path string) {
    // è§„èŒƒåŒ–è·¯å¾„: /users/123 â†’ /users/:id
    normalizedPath := normalizePath(path)
    
    histogram.Record(ctx, duration, metric.WithAttributes(
        attribute.String("http.route", normalizedPath),
    ))
}

// æ–¹æ¡ˆ 3: çŠ¶æ€ç åˆ†ç»„
view := metric.NewView(
    metric.Instrument{Name: "http.server.duration"},
    metric.Stream{
        AttributeFilter: func(kv attribute.KeyValue) bool {
            if string(kv.Key) == "http.status_code" {
                // ä¿ç•™çŠ¶æ€ç ç±»åˆ« (2xx, 3xx, 4xx, 5xx)
                code := kv.Value.AsInt64()
                return code >= 200 && code < 600
            }
            return true
        },
    },
)
```

### 2. æ€§èƒ½ä¼˜åŒ–

```go
// å‡å°‘å¯¼å‡ºçš„æŒ‡æ ‡æ•°é‡
view := metric.NewView(
    metric.Instrument{Name: "debug.*"},
    metric.Stream{
        Aggregation: metric.AggregationDrop{}, // ç”Ÿäº§çŽ¯å¢ƒç¦ç”¨è°ƒè¯•æŒ‡æ ‡
    },
)

// ç®€åŒ– Histogram æ¡¶
view := metric.NewView(
    metric.Instrument{Kind: metric.InstrumentKindHistogram},
    metric.Stream{
        Aggregation: metric.AggregationExplicitBucketHistogram{
            Boundaries: []float64{10, 100, 1000}, // åªç”¨ 3 ä¸ªæ¡¶
        },
    },
)

// å‡å°‘å±žæ€§æ•°é‡
view := metric.NewView(
    metric.Instrument{Name: "*"},
    metric.Stream{
        AttributeFilter: func(kv attribute.KeyValue) bool {
            // åªä¿ç•™æ ¸å¿ƒå±žæ€§
            key := string(kv.Key)
            coreAttrs := []string{"service.name", "http.method", "http.status_code"}
            for _, core := range coreAttrs {
                if key == core {
                    return true
                }
            }
            return false
        },
    },
)
```

### 3. æˆæœ¬æŽ§åˆ¶

```go
// çŽ¯å¢ƒç›¸å…³é…ç½®
func getViewsForEnvironment(env string) []metric.View {
    switch env {
    case "production":
        return []metric.View{
            // ç”Ÿäº§çŽ¯å¢ƒï¼šä¿ç•™æ ¸å¿ƒæŒ‡æ ‡ï¼Œåˆ é™¤è°ƒè¯•æŒ‡æ ‡
            metric.NewView(
                metric.Instrument{Name: "debug.*"},
                metric.Stream{Aggregation: metric.AggregationDrop{}},
            ),
            // ç®€åŒ– Histogram
            metric.NewView(
                metric.Instrument{Kind: metric.InstrumentKindHistogram},
                metric.Stream{
                    Aggregation: metric.AggregationExplicitBucketHistogram{
                        Boundaries: []float64{10, 100, 1000},
                    },
                },
            ),
        }
    case "development":
        return []metric.View{
            // å¼€å‘çŽ¯å¢ƒï¼šä¿ç•™æ‰€æœ‰æŒ‡æ ‡ï¼Œè¯¦ç»† Histogram
            metric.NewView(
                metric.Instrument{Kind: metric.InstrumentKindHistogram},
                metric.Stream{
                    Aggregation: metric.AggregationExplicitBucketHistogram{
                        Boundaries: []float64{1, 2, 5, 10, 20, 50, 100, 200, 500, 1000, 2000, 5000},
                    },
                },
            ),
        }
    default:
        return []metric.View{}
    }
}
```

---

## æœ€ä½³å®žè·µ

```go
// âœ… æ­£ç¡®: é…ç½®åˆç†çš„ Histogram æ¡¶
view := metric.NewView(
    metric.Instrument{Name: "http.server.duration"},
    metric.Stream{
        Aggregation: metric.AggregationExplicitBucketHistogram{
            Boundaries: []float64{0, 5, 10, 25, 50, 75, 100, 250, 500, 1000},
        },
    },
)

// âŒ é”™è¯¯: æ¡¶å¤ªå¤šæˆ–å¤ªå°‘
view := metric.NewView(
    metric.Instrument{Name: "http.server.duration"},
    metric.Stream{
        Aggregation: metric.AggregationExplicitBucketHistogram{
            Boundaries: []float64{100}, // å¤ªå°‘
        },
    },
)

// âœ… æ­£ç¡®: è¿‡æ»¤é«˜åŸºæ•°å±žæ€§
view := metric.NewView(
    metric.Instrument{Name: "*"},
    metric.Stream{
        AttributeFilter: func(kv attribute.KeyValue) bool {
            key := string(kv.Key)
            return key != "user.id" && key != "session.id"
        },
    },
)

// âœ… æ­£ç¡®: ç¦ç”¨ä¸éœ€è¦çš„æŒ‡æ ‡
view := metric.NewView(
    metric.Instrument{Name: "internal.*"},
    metric.Stream{
        Aggregation: metric.AggregationDrop{},
    },
)

// âœ… æ­£ç¡®: ä¸ºä¸åŒçŽ¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®
views := getViewsForEnvironment(os.Getenv("ENV"))
```

---

## å¸¸è§é—®é¢˜

**Q1: ä½•æ—¶ä½¿ç”¨ Viewï¼Ÿ**

```text
åº”è¯¥ä½¿ç”¨ View:
âœ… éœ€è¦æ›´æ”¹æŒ‡æ ‡åç§°/æè¿°
âœ… éœ€è¦è‡ªå®šä¹‰ Histogram æ¡¶
âœ… éœ€è¦é™ä½ŽåŸºæ•°
âœ… éœ€è¦ç¦ç”¨æŸäº›æŒ‡æ ‡
âœ… éœ€è¦è¿‡æ»¤å±žæ€§

ä¸éœ€è¦ View:
âŒ é»˜è®¤é…ç½®å·²æ»¡è¶³éœ€æ±‚
âŒ å¯ä»¥åœ¨åº”ç”¨ä»£ç ä¸­è§£å†³
```

**Q2: View çš„æ‰§è¡Œé¡ºåºï¼Ÿ**

```text
View æŒ‰æ³¨å†Œé¡ºåºæ‰§è¡Œ:
mp := metric.NewMeterProvider(
    metric.WithView(view1), // ç¬¬ä¸€ä¸ª
    metric.WithView(view2), // ç¬¬äºŒä¸ª
    metric.WithView(view3), // ç¬¬ä¸‰ä¸ª
)

æ³¨æ„:
- ç¬¬ä¸€ä¸ªåŒ¹é…çš„ View ç”Ÿæ•ˆ
- åŽç»­ View ä¸ä¼šå†å¤„ç†å·²åŒ¹é…çš„ Instrument
```

**Q3: å¦‚ä½•è°ƒè¯• View é…ç½®ï¼Ÿ**

```go
// ä½¿ç”¨ stdout exporter æŸ¥çœ‹æœ€ç»ˆæŒ‡æ ‡
exporter, _ := stdoutmetric.New(
    stdoutmetric.WithPrettyPrint(),
)

mp := metric.NewMeterProvider(
    metric.WithReader(metric.NewPeriodicReader(exporter)),
    metric.WithView(yourView),
)

// è¿è¡Œåº”ç”¨ï¼ŒæŸ¥çœ‹è¾“å‡ºçš„æŒ‡æ ‡åç§°ã€å±žæ€§ç­‰
```

---

## å‚è€ƒèµ„æº

- [OpenTelemetry View](https://opentelemetry.io/docs/specs/otel/metrics/sdk/#view)
- [Go SDK View](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/metric#View)
- [02_Meteråˆ›å»º.md](./02_Meteråˆ›å»º.md)
- [04_èšåˆå™¨.md](./04_èšåˆå™¨.md)

---

**ðŸŽ‰ æ­å–œï¼ä½ å·²ç»æŽŒæ¡äº† View é…ç½®çš„å®Œæ•´çŸ¥è¯†ï¼**

çŽ°åœ¨ä½ å¯ä»¥ï¼š

- âœ… åˆ›å»ºå’Œæ³¨å†Œ View
- âœ… ä½¿ç”¨é€‰æ‹©å™¨åŒ¹é… Instrument
- âœ… é…ç½®èšåˆç±»åž‹å’Œ Histogram æ¡¶
- âœ… è¿‡æ»¤å’Œè½¬æ¢å±žæ€§
- âœ… é™ä½ŽåŸºæ•°å’ŒæŽ§åˆ¶æˆæœ¬
